2006-12-23	smcgraw@frii.com

	* perl/load_jmdict.pl[1.4]
	Fix: was not generating correct data for tables restr, stagr, 
	  stagk when some items has restrictions (including re_nokanj)
	  and others didn't.

	* pg/mktables.sql
	Change column name in table aufio from "start" to "strt"
	  because former is a SQL-2003 reserved word.
	
	* pg/postload.sql
	Do a "vacuum analyze" as last step.

	* perl/README.txt
	Reorganized load instructions again.


2006-12-23	smcgraw@frii.com

	* load_jmdict.pl[1.3]
	Fix: hist data not written to output dmp file.
	Fix: eliminate deplicate keys kfreq and rfreq tables that
	  resulted in error when loaded into database with result
	  that both tables ended up empty.
	Guess OS based on environment variable and assume encoding
	  for interactive output of utf-8 is Unix or shift_jis is
	  Windows.
	

2006-12-22	smcgraw@frii.com

	* pg/mkfk.sql pg/mkindex.sql pg/mkperms.sql pg/mktables 
	* load_jmdict.pl
	Change name of table "audit" to "hist".  Add new table "audio".

	* perl/README.txt
	Reorganized load instructions.

	* pg/postload.sql pg/xresolv.sql
	xresolv.sql will create xref table extries based on contents
	  of table xresolv loaded with jmdict data.  postload.sql
	  modified to call xresolv.sql as part of postload processing.

2006-12-18	smcgraw@frii.com

	* Tag T007
	At this point the perl jmdict loader sucessfully loads 
	  jmdict into a postgresql database, using the instructions
	  in perl/README.txt.  The mysql stuff is obsolete and the
	  python stuff is probably broken.

	* pg/mkfk.sql pg/mkindex.sql pg/mkperms.sql pg/mktables.sql
	  pg/mkviews.sql pg/postload.sql pg/reload.sql pg/schema.sql
	Replace schema.sql with a separate scripts for creating tables,
	  indexes, foreign keys, etc.  This is because new loader method
	  uses postgresql copy commands in file and does the indexing, 
	  etc afterwards.
	Database name changed from jb to jmdict.

	* perl/load_jmdict.pl perl/JMdict.pm perl/README.txt
	Database loader written in Perl.  Requires module XML::Twig.
	JMdict.pm module maps JMdict xml file text strings to database
	keyword id numbers.

2006-12-18	smcgraw@frii.com

	* Tag T006
	Around 2006/11/30 a decision seems to have been taken on 
	  on the jmdict mailing list to base the jmdict database system
	  on postgreslql and perl.
	  I rearranged the cvs directory structure to support this.  (Since
	  this was done on the CVS repository, it is "retroactive".)
	  This tag identified the code base (in the new directory structure)
	  as it existed prior to switch focus to perl.  Because of the directory
	  changes, many python scripts probably won't run as-is.
	  Also, some schema changes were made related to the audit table
	  that haven't been propagated to the python scripts yet.

2006-11-03	smcgraw@frii.com

	* Tag T005
	Cgi search form, result list, and entry pages seem to mostly
	  work ok.  

2006-11-03	smcgraw@frii.com

	* jbdb.py[1.7]
	Fixed build_search_sql() which returned bad sql under a 
	  number of circumstances.
	Enhance mk_from_clause() to do left rather than inner join
	  if table name prefixed with asterisk.  Need this because we 
	  need outer join when looking for "or" of frequency values. 
	
	* entr.css
	Add formatting for srchfrm.html

	* www/srchres.py
	Accept option string as commnd argument.
	Fix the frequency-of-use input stuff so that it is functional 
	  now.
	Allow display of search sql on results page for debugging.
	Fix problem where searching for two glosses would never find 
	  anything because the generated sql asked for rows where the
	  same gloss was simulataneously equal to g1 and g2.  Now, g1
	  and g2 need only occur in the same sense.  (We probably
	  want "in the same entry" iunstead, but that will need to 
	  wait.)  Same problem also occured (and ws fixed) for kanji 
	  and reading searches too.

	* www/templates/entr.tal
	Fix synonym, antonym links.

	* wwww/templates/srchfrm.tal
`	Change the use of class attributes to allow better formating
	  in css.
	Correct misnamed "misc" and "nfcmp" elements.
	Minor layout changes such as moving search button and adding
	  horizonal rules between sections.

	* www/templates/srchres.tal
	Add a debug section for displaying the search sql used.

2006-10-26	smcgraw@frii.com

	* jbdb.py
	mk_from_clause() was broken, failed to generate valid sql in 
	  some cases because it assumed the added table always should
	  be joined to the previously added table but that is often 
	  wrong; need to join to parent table which may have been 
	  added much earlier.
	Enhance mk_from_clause() to allow multiple instances of the 
	  same table with different aliases.  This fixes problem 
	  where giving (for example) two "gloss" conditions would
	  always results in 0 records found because the sql asked
	  for a record in which gloss.txt was simultaneously equal
	  to two different values.   

2006-10-26	smcgraw@frii.com

	* README.txt[1.4]
	Update for cgi stuff.

	* jbdb.py[1.6]
	DbRow object wasn't keeping attribute values in sync with
	  list values, does now.  Derive from object (instead of list
	  as before) and keep values as attributes, map indexed access
	  to attribute access.
	Remove function rslv_refs() since it is no longer used
	  by anything.  
	Add function build_search_sql() and its helper, 
	  mk_from_clasuse()  This is a slightly rewritten version
	  of what was in showentr.py.

	* showentr.py[1.7]
	Move function build_search_sql() to jbdb.py.

	* www/entr.py[1.1] www/srchfrm.py[1.1] www/srchres.py[1.1]
	* www./simpleTalHelper.py[1.1] www/entr.css[1.1]
	* www/templates/entr.tal[1.l] www/templates/srchfrm.tal[1.l]
	* www/templates/srchres.tal[1.l]
	New files added to demonstrate access via cgi.

2006-10-19	smcgraw@frii.com

	Tag T004:
	Tested on Windows 2000 with postgresql-8.1.4, Python-2.5,
	  psycopg2-2.0.5.1.
	Tested on Fedora Core 5 with mysql-5.0.22, Python-2.4.3,
	  MySQLdb-1.2.0,

2006-10-16	smcgraw@frii.com

	* jbdb.py[1.5]
	In class jbdb.DbRow, was previously maintaining duplicate 
	  values, one set in the list part of self, the other in 
	  attributes leading to inevitable cases where they got out 
	  of sync. Instead, override __getattr__, __setattr__ to get 
	  set the list values when accessed through attributes.

	* pg/db.py[1.2]
	Pass whatever arguments dbOpen() gets directly to the dbapi
	  connect call.  This moves responsibilty for maintaining 
	  default argument values to the caller and allows not passing
	  some arguments (like usename, which psycopg2 will then 
	  default to the current user's username) if desired.  

	* mysql/db.py[1.2]
	Same changes as for pg/db.py but need to translate some args
	  into mysql dialect, and add some additional parameters for 
	  the unicode issues.
	'conn.charset' was being set to "utf-8".  I think the hyphen 
	  is an error, changed to "utf8"
	Added missing .lastauto() method to Cursor.

2006-10-15	smcgraw@frii.com

	* tables.py[1.2]
	Changes to support recursive read in jbdb.DbRow class:
	Add a _pk attribute to all tables.
	Add restr, stagr, and stagk related classes to kana, sens,
	  and sens tables.  This will result in then being read
	  and written automatically, instead of handling them outside
	  of this framework as previously.
	Change the contents of the _related attribute from strings
	  naming that attribute that the "related" list will be
	  attached to on the object, to a list of classes that will
	  be used to instansiate list elements.  Attribute name will
	  be taken from the classes _table attribute.
	Rearrange order of classes to prevent undefined name errors
	  when executing the class definitions.
 	  
	* jbdb.py
	Add DbRow methods() ._read() and ._readrel() that will allow
	  initializing in an instance's data by a database read, and
	  recursively for all related row instances.  This is what drove
	  the changes to tables.py.
	Added functions rslv_refs() and load() (latter moved here from 
	  showentr.py).
	Added/updated comments.

	* pg/schema.sql[1.2]
	Rename view "kr_valid" to "rk_validity".
	Add column k.id to view "re_nokanji".
	Add view rk_valid which will correctly give the valid kanji
	  (including the "nokanji" case) for all readings of any entry,
	  efficiently.

	* load_jjmdict.py
	Updated for consistency with jbdb.py[1.5] and tables.py[1.2].
	Completely rework hanfdling of restr, stagr, and stagk elements.
	  They are now inverted at the time the elements are processed
	  instead of deffering procesing until the entr object is 
	  completely built. 
	Remove debugging print statement inadvertantly left in the 
	  previous version.
	Changed the commit interval from 3975 to 200 after reading 
	  that postgres will slow down when a large number of uncommited 
	  transactions have accumulated, and that one user found (in 
	  a completely dissimilar application) the sweet spot was in 
	  the low hundreds of transactions.  (For us each entr insert 
	  represents a half dozen or more transactions, so we may still 
	  be too high.)

	* showentr.py[1.6]
	Updated for consistency with jbdb.py[1.5] and tables.py[1.2].
	Use the new recursive Entr._read() method to initialize 
	  entry data rather than executing a bunch on sql statements.
	Move function load() into jbdb.py.

	* README.txt[1.3]
	Clarify alarming messages when running the reload.sql script.

2006-10-11	smcgraw@frii.com

	* load_jmdict.py[1.5]
	Propagate part-of-speech information to folowing senses in
	each entry.

	Remove the Def_enc global and the code that set if from locale.  
	It wasn't used, and if we need the encoding, we can get it from 
	sys.stdout.encoding.

2006-10-10	smcgraw@frii.com

	Tag R002: Posted to jmdict mailing list. 2006-10-10.

2006-10-10	smcgraw@frii.com

	Tag T004: Changes to suppport Postgresql in addition to Mysql.

	* Changes.txt pg/db.py mysql/db.py
	New files.

	* jbdb.py[1.4]
	Move Cursor class, function dbOpen() into pg/db.py and mysql/db.py.
	Instead of executing db-specific sql to get the last used auto-number
	  value, move that sql into new cursor method .lastauto() in each
	  of the db-specific db.py modules, and call it in jbdb.py.

	* load_jmdict.py[1.5]
	Get rid of mysql specific code.

	* loadkw.sql reload,sql schema.sql 
	Move into the database-specific directories pg/ and mysql/.

	* README.txt[1.2]
	Updated to include new info about postgresql, remove
	some old info no longer relevent.

	* mysql/schema.sql[1.1]
	Add view "entr_summary".

	* showentr.py[1.4]
	Get rid of mysql specific code.
	When printing glosses, explicitly convert to default encoding
	  so can use "replace" to avoid exception when an unconvertable
	  utf8 character encountered, as commonly happens with iso9959-x
	  characters when default encoding is something like sjis.
	Use query "entr_summary" to get matched entries list, rather
	  than doing the sql in the script.  **Note**: This results
	  in very long response times for the "find>" command when
	  using Mysql, because Mysql executes the view's sql without
	  any consideration of the outer WHERE clause!
	Drop the temp table before trying to create it.
	Conditionalize the sql executed to create the temp table for 
	  mysql or postgresql.

	* sitecustomize[1.2]
	It wasn't actually setting the default encoding. Fixed.

2006/10/09	smcgraw@frii.com

	Tags to date:
	T003	Last (I hope) Mysql-only files.
	T002	Files distributed on the jmdict mailing list, 2006/09/21.
	T001	Initial commit
