
2007-01-28	smcgraw@frii.com

	* load_jmdict.pl
	Change increment used for "ord" columns from 10 to 1.

	* perl/lib/jmdict.pm
	Fix errant keystroke that causes syntax error.

2007-01-27	smcgraw@frii.com

	* perl/cgi/entr.css
	Add entry.notice and entry.caution formats.

	* perl/cgi/entr.pl
	Add validation of url parameters.
	Generate error page if parameters are bad..

	* perl/cgi/nwform.pl
	* perl/cgi/nwconf.pl
	* perl/cgi/nesub.pl
	New: Page generators for Add New Word web interface.

	* perl/lib/jmdict.pm
	Fix: jstr_classify not setting KATAKANA bit properly.
	Add functions dbinsert() and addrentr().
	Provide more info in cross ref display: In EntrList()
	  change the sql used to read xref data.
	
	* perl/lib/jmdictcgi.pm
	New: Support functions for the cgi code.

	* perl/lib/tal/entr.tal
	Provide more info in cross ref display: adjust template to
	  use more detailed xref data.
	Display sense notes.
	Display id info as {id/ord} rather than {ord/id}.
	Comment out gloss lang since we will be using the english
	  only jmdict from here on.  (The non-english enties in
	  the jmdict.xml file are merged in from other projects
	  and won't be maintained by the jmdict project, at least 
	  imediately.)
	Add h1 title.

	* perl/lib/tal/srchres.tal
	Add h1 title.

	* perl/lib/tal/srchform.tal
	Add notice about priority of Id Number search.
	Add usage notes at bottom of page.
	Make seq number search the defaut option (was entry id)
	Change titles of id number search text boxes.
	Change default for gA search compare from "<=" to ">=".
	Add h1 title.

	* perl/lib/tal/nwform.tal
	* perl/lib/tal/nwconf.tal
	New: Templates for Add New Word web interface.

	* perl/lib/jmdictxml.pm
	Fix: correct missing trailing space in expanded entity 
	  text for RINF/uk.

	* pg/syncseq.sql
	Update the new "seq" sequence (see mktables.sql).

	* pg/mkfk.sql
	Fix: missing fk in stagk to kanj.id.

	* pg/mktables.sql
	Add new sequence "seq" to provide seq numbers for table
	  "entr".  These expected to be obtained and used by the
	  application code -- they are not used as entr.seq default
	  values.

	* pg/mkviews.sql
	Provide more info in cross ref display: replace view sref
	  with xsum and xsumr for generating sens->entry xref records
	  from db's native sens->sens data.

2007-01-15	smcgraw@frii.com

	* perl/load_googits.pl [1.3]
	Fix: was warning about texts that resolved to multiple
	  entries but still added the [kr]freq googits values.
	  Now it skips them.

	* pg/mkviews [1.5]
	Add views pkanj and prdng to give a view of kanj or
	  rdng table with additional column that indicates if
	  the kanj/rdng would have "P" tag in edict.

2007-01-15	smcgraw@frii.com

	* perl/load_googits.pl [1.2]
	Fix call dbi method disconnect() (was typo finish()).

	* pg/mkviews.sql [1.4]
	Explicitly create the plpgsql language since it does not 
	  exist in a default Postgresql install but may be present
	  in some installs (e.g. Windows if selected at install
	  time).

2007-01-15	smcgraw@frii.com

	* perl/load_googits.pl [1.1]
	* pg/data/kwfreq.sql [1.2]
	Add support fo google hit counts as kfreq/rfreq FoU metric.

	* perl/cgi/srchform.pl [1.2]
	* perl/cgi/srchres.pl [1.2]
	* perl/lib/tal/srchform.tal [1.2]
	Add support for entry status and google hit counts.

	* pg/mkindex.sql [1.4]
	Disable unique indexes on (entr,txt) for tables kanj and 
	  rdng and (sens.txt) for table gloss because (as of 
	  2007-01-14) duplicates exist in the jmdict xml file.

	* pg/mktables.sql [1.7]
	Fix syntax error typo.

	* pg/mkviews.sql [1.3]
	Add experimental functions dupentr and delentr.

	* pg/data/kwstat.sql [1.2]
	Shorten 'descr' text a little.

2007-01-13	smcgraw@frii.com

	* Tag T009
	This bring the Perl web interface code to approxmately where 
	  the Python code was when work switched to Perl.  At this point
	  some support code has been added for better history trackng
	  and and update process but it is incomplete.

	* perl/load_jmdict.pl [1.11]
	Fix: Forgot to write out new "diff" column when creating
	  load records for table hist as needed by maketables.sql[1.6].

	* perl/cgi/entr.css [1.3]
	Tweak fomatting of srchres page.

	* perl/cgi/entr.pl [1.3]
	Fix: reading of db login info from file jmdict.cfg. 

	* perl/lib/jmdict.pm [1.5]
	Add new subs:
	  - kwrecs to get a single set of record values without duplicates 
	  from a keyword data structure.
	  - jstr_classify to identify the types of japanese characters in a
	  string.

	* perl/lib/jmdicttal.pm [1.3]
	Steal the split_args() and fetch_arg() subs from Petal::Utils and
	  rewrite our modifiers to use them.
	Add new modifiers "gt", "lt", "len", and (untested) "perl".
	Change "freqs" modifier to not require first argument "FREQ".

	* perl/lib/tal/entr.tal [1.3]
	Put single quotes around keyword type strings, and remove FREQ type
	  from modifer "freqs", as required by revised modifiers in 
	  jmdicttal.pm [1.3].

	* perl/cgi/srchform.pl
	* perl/cgi/srchres.pl
	* perl/lib/tal/srchform.tal
	* perl/lib/tal/srchres.tal
	New files to provide search form an results pages.

2007-01-09	smcgraw@frii.com

	* pg/mkindex.sql [1.3]
	Add unique indexes on columns (entr,ord) in tables rdng,
	  kanj,sens,gloss.  These are needed because the function 
	  (under development) that duplicates entries need to match
	  up old and new rdng's, kanj,s and sens's to duplicate the
	  restriction table entries, and uses unique ord numbers to
	  do that.
	Add unique indexes on columns (entr,txt) in tables rdng,
	  kanj, and gloss.  This disallows duplicate txt values
	  in the same entry.
	Add partial index on entr.stat.
	Add index on audio.fname.

	* pg/mktables.sql [1.6]
	Add "diff" column to "hist" table.

	* pg/mkindex.sql [1.3]
	* pg/mkperms.sql [1.4]
	* pg/mktables.sql [1.6]
	Add new "editor" table.

2007-01-08	smcgraw@frii.com

	* perl/lib/jmdict.pl
	Fix: Correctly index keyword records by kw string in sub 
	  Kwds.  Previously they were only indexed by id due to
	  programer brain-deadness.

2007-01-06	smcgraw@frii.com

	* perl/load_jmdict.pl perl/cgi/entr.pl 
	Make shebang line use env program rather than hardwiring the
	  location of the perl interpreter.

	* perl/showentr.pl
	Make shebang line use env program rather than hardwiring the
	  location of the perl interpreter.
	Replace embedded utf-8 characters with escaped notation
	  (eg "\x{3010}").  This eliminates the need for the file
	  to be utf-8 encoded, which in turn prevents Microsoft
	  windows from making the first three bytes a binary bom
	  which confuses unix machines.

2007-01-05	smcgraw@frii.com

	* perl/load_jmdict.pl [1.9]
	* perl/lib/jmdict.pm [1.3]
	* pg/loadkw.sql [1.3]
	* pg/mkfk.sql [1.3]
	* pg/mkperms.sql [1.3]
	* pg/mktables.sql [1.5]
	* pg/data/kwstat.sql[1.1]
	Change the "stat" column in tables "entr" and "hist" from
	  a checked character to a keyword integer that is a foreign
	  key to new table "kwstat".

	* perl/showentr.pl [1.4]
	* perl/cgi/entr.css [1.2]
	* perl/lib/jmdicttal.pm [1.2]
	* perl/lib/tal/entr.tal [1.2]
	Show status (entr.stat) when displaying entries.

2007-01-05	smcgraw@frii.com

	* Tag T008

2007-01-04	smcgraw@frii.com

	* perl/lib/jmdict.pm
	Moved jmdict.pm from directory perl/ to perl/lib/ (in CVS 
	  repository).
	Change some hash key names in the structure returned by 
	  EntrList to be more consistent with table/column names.
	In KW structure, use same 1st level key (e.g. 'POS') to 
	  hold both 'kw' hash and 'id' hash.  Formerly the latter
	  used a key prefixed with "i" (e.g. 'iPOS'). 
	Move sub filt() from showentr.pl to here.
	Add sub's irestr(), istagr(), istagk() which will convert
	  the restriction lists from the database form to jmdict form. 

	* perl/load_jmdict.pl perl/lib/jmdictxml.pm
	Moved jmdictxml.pm from directory perl/ to perl/lib/ (in CVS 
	  repository).

	* perl/showentr.pl
	Moved jmdict.pm from directory perl/ to perl/lib/ (in CVS 
	  repository).
	Track the entry hash key name changes and KW key changes made
	  in perl/lib/jmdict.pl.
	Fix: displayed kanji freq data was actually erroneously using
	  reading frequency data.
	Fix: Stagr/stagk restrictions weren't displaying.
	Fix: History notes weren't displaying.
	Eliminate some warnings reported by "use warnings".
	Move sub filt() to jmdict.pm.
	Add code to show reverse cross refs.

	* perl/cgi/entr.pl perl/cgi/entr.css perl/lib/jmdicttal.pm  
	* perl/lib/tal/entr.tal
	Add demo/devtool cgi script entr.pl and supporting files
	  jmdicttal.pm, entr.tal, entr.css

	* pg/postload.sql pg/syncseq.sql
	Set the currval of all sequences after loading database.  
	  Otherwise inserts that use a defaulted id will fail.

2006-12-30	smcgraw@frii.com

	* perl/showentry.pl[1.2]
	Fix handling of multiple command line args.
	Fix display of dialect and language elements.

2006-12-26	smcgraw@frii.com

	* perl/jmdictxml.pm[1.2]
	Renamed JMdict.pm to jmdictxml.pm.  This was done in
	  CVS repository so is "retroactive".

	* perl/load_jmdict.pl[1.7]
	Use renamed jmdictxml.pm.
	Add help option and usage() sub.

	* perl/jmdict.pm[1.1]
	New.  Contains common database access subs.

	* perl/showentry.pl[1.1]
	New.  Console app to display all info for specified jmdict
	  entries.

2006-12-26	smcgraw@frii.com

	* perl/load_jmdict.pl[1.6]
	When hist records are created by load_jmdixt.pl, create them 
	  with stat='A' instead of null. 

	* pg/mktables.sql[1.4]
	In table hist, change name of (what was) column 'ostat' to 'stat'
	  and add NOT NULL constraint, don't allow 'stat' to be a space 
	  character. 

	* pg/mkviews.sql[1.2]
	Changed old convention of using 'k','j' aliases for tables
	  'rdng' and 'kanj' to new convention 'r','k'.
	Add view 'sref'.

	* pg/postload.sql[1.4]
	Set permissions as last step rather than earlier so that all
	  database object will have been created.

2006-12-25	smcgraw@frii.com

	* perl/load_jmdict.pl[1.5]
	Fix: gloss language attribute was not read correctly and all 
	  glosses were defaulted to "en".

2006-12-23	smcgraw@frii.com

	* perl/load_jmdict.pl[1.4]
	Fix: was not generating correct data for tables restr, stagr, 
	  stagk when some items has restrictions (including re_nokanj)
	  and others didn't.

	* pg/mktables.sql[1.3]
	Change column name in table aufio from "start" to "strt"
	  because former is a SQL-2003 reserved word.
	
	* pg/postload.sql[1.3]
	Do a "vacuum analyze" as last step.

	* perl/README.txt
	Reorganized load instructions again.


2006-12-23	smcgraw@frii.com

	* load_jmdict.pl[1.3]
	Fix: hist data not written to output dmp file.
	Fix: eliminate deplicate keys kfreq and rfreq tables that
	  resulted in error when loaded into database with result
	  that both tables ended up empty.
	Guess OS based on environment variable and assume encoding
	  for interactive output of utf-8 is Unix or shift_jis is
	  Windows.
	

2006-12-22	smcgraw@frii.com

	* pg/mkfk.sql pg/mkindex.sql pg/mkperms.sql pg/mktables 
	* load_jmdict.pl
	Change name of table "audit" to "hist".  Add new table "audio".

	* perl/README.txt
	Reorganized load instructions.

	* pg/postload.sql pg/xresolv.sql
	xresolv.sql will create xref table extries based on contents
	  of table xresolv loaded with jmdict data.  postload.sql
	  modified to call xresolv.sql as part of postload processing.

2006-12-18	smcgraw@frii.com

	* Tag T007
	At this point the perl jmdict loader sucessfully loads 
	  jmdict into a postgresql database, using the instructions
	  in perl/README.txt.  The mysql stuff is obsolete and the
	  python stuff is probably broken.

	* pg/mkfk.sql pg/mkindex.sql pg/mkperms.sql pg/mktables.sql
	  pg/mkviews.sql pg/postload.sql pg/reload.sql pg/schema.sql
	Replace schema.sql with a separate scripts for creating tables,
	  indexes, foreign keys, etc.  This is because new loader method
	  uses postgresql copy commands in file and does the indexing, 
	  etc afterwards.
	Database name changed from jb to jmdict.

	* perl/load_jmdict.pl perl/JMdict.pm perl/README.txt
	Database loader written in Perl.  Requires module XML::Twig.
	JMdict.pm module maps JMdict xml file text strings to database
	keyword id numbers.

2006-12-18	smcgraw@frii.com

	* Tag T006
	Around 2006/11/30 a decision seems to have been taken on 
	  on the jmdict mailing list to base the jmdict database system
	  on postgreslql and perl.
	  I rearranged the cvs directory structure to support this.  (Since
	  this was done on the CVS repository, it is "retroactive".)
	  This tag identified the code base (in the new directory structure)
	  as it existed prior to switch focus to perl.  Because of the
	  directory changes, many python scripts probably won't run as-is.
	  Also, some schema changes were made related to the audit table
	  that haven't been propagated to the python scripts yet.

2006-11-03	smcgraw@frii.com

	* Tag T005
	Cgi search form, result list, and entry pages seem to mostly
	  work ok.  

2006-11-03	smcgraw@frii.com

	* jbdb.py[1.7]
	Fixed build_search_sql() which returned bad sql under a 
	  number of circumstances.
	Enhance mk_from_clause() to do left rather than inner join
	  if table name prefixed with asterisk.  Need this because we 
	  need outer join when looking for "or" of frequency values. 
	
	* entr.css
	Add formatting for srchfrm.html

	* www/srchres.py
	Accept option string as commnd argument.
	Fix the frequency-of-use input stuff so that it is functional 
	  now.
	Allow display of search sql on results page for debugging.
	Fix problem where searching for two glosses would never find 
	  anything because the generated sql asked for rows where the
	  same gloss was simulataneously equal to g1 and g2.  Now, g1
	  and g2 need only occur in the same sense.  (We probably
	  want "in the same entry" iunstead, but that will need to 
	  wait.)  Same problem also occured (and ws fixed) for kanji 
	  and reading searches too.

	* www/templates/entr.tal
	Fix synonym, antonym links.

	* wwww/templates/srchfrm.tal
`	Change the use of class attributes to allow better formating
	  in css.
	Correct misnamed "misc" and "nfcmp" elements.
	Minor layout changes such as moving search button and adding
	  horizonal rules between sections.

	* www/templates/srchres.tal
	Add a debug section for displaying the search sql used.

2006-10-26	smcgraw@frii.com

	* jbdb.py
	mk_from_clause() was broken, failed to generate valid sql in 
	  some cases because it assumed the added table always should
	  be joined to the previously added table but that is often 
	  wrong; need to join to parent table which may have been 
	  added much earlier.
	Enhance mk_from_clause() to allow multiple instances of the 
	  same table with different aliases.  This fixes problem 
	  where giving (for example) two "gloss" conditions would
	  always results in 0 records found because the sql asked
	  for a record in which gloss.txt was simultaneously equal
	  to two different values.   

2006-10-26	smcgraw@frii.com

	* README.txt[1.4]
	Update for cgi stuff.

	* jbdb.py[1.6]
	DbRow object wasn't keeping attribute values in sync with
	  list values, does now.  Derive from object (instead of list
	  as before) and keep values as attributes, map indexed access
	  to attribute access.
	Remove function rslv_refs() since it is no longer used
	  by anything.  
	Add function build_search_sql() and its helper, 
	  mk_from_clasuse()  This is a slightly rewritten version
	  of what was in showentr.py.

	* showentr.py[1.7]
	Move function build_search_sql() to jbdb.py.

	* www/entr.py[1.1] www/srchfrm.py[1.1] www/srchres.py[1.1]
	* www./simpleTalHelper.py[1.1] www/entr.css[1.1]
	* www/templates/entr.tal[1.l] www/templates/srchfrm.tal[1.l]
	* www/templates/srchres.tal[1.l]
	New files added to demonstrate access via cgi.

2006-10-19	smcgraw@frii.com

	Tag T004:
	Tested on Windows 2000 with postgresql-8.1.4, Python-2.5,
	  psycopg2-2.0.5.1.
	Tested on Fedora Core 5 with mysql-5.0.22, Python-2.4.3,
	  MySQLdb-1.2.0,

2006-10-16	smcgraw@frii.com

	* jbdb.py[1.5]
	In class jbdb.DbRow, was previously maintaining duplicate 
	  values, one set in the list part of self, the other in 
	  attributes leading to inevitable cases where they got out 
	  of sync. Instead, override __getattr__, __setattr__ to get 
	  set the list values when accessed through attributes.

	* pg/db.py[1.2]
	Pass whatever arguments dbOpen() gets directly to the dbapi
	  connect call.  This moves responsibilty for maintaining 
	  default argument values to the caller and allows not passing
	  some arguments (like usename, which psycopg2 will then 
	  default to the current user's username) if desired.  

	* mysql/db.py[1.2]
	Same changes as for pg/db.py but need to translate some args
	  into mysql dialect, and add some additional parameters for 
	  the unicode issues.
	'conn.charset' was being set to "utf-8".  I think the hyphen 
	  is an error, changed to "utf8"
	Added missing .lastauto() method to Cursor.

2006-10-15	smcgraw@frii.com

	* tables.py[1.2]
	Changes to support recursive read in jbdb.DbRow class:
	Add a _pk attribute to all tables.
	Add restr, stagr, and stagk related classes to kana, sens,
	  and sens tables.  This will result in then being read
	  and written automatically, instead of handling them outside
	  of this framework as previously.
	Change the contents of the _related attribute from strings
	  naming that attribute that the "related" list will be
	  attached to on the object, to a list of classes that will
	  be used to instansiate list elements.  Attribute name will
	  be taken from the classes _table attribute.
	Rearrange order of classes to prevent undefined name errors
	  when executing the class definitions.
 	  
	* jbdb.py
	Add DbRow methods() ._read() and ._readrel() that will allow
	  initializing in an instance's data by a database read, and
	  recursively for all related row instances.  This is what drove
	  the changes to tables.py.
	Added functions rslv_refs() and load() (latter moved here from 
	  showentr.py).
	Added/updated comments.

	* pg/schema.sql[1.2]
	Rename view "kr_valid" to "rk_validity".
	Add column k.id to view "re_nokanji".
	Add view rk_valid which will correctly give the valid kanji
	  (including the "nokanji" case) for all readings of any entry,
	  efficiently.

	* load_jjmdict.py
	Updated for consistency with jbdb.py[1.5] and tables.py[1.2].
	Completely rework hanfdling of restr, stagr, and stagk elements.
	  They are now inverted at the time the elements are processed
	  instead of deffering procesing until the entr object is 
	  completely built. 
	Remove debugging print statement inadvertantly left in the 
	  previous version.
	Changed the commit interval from 3975 to 200 after reading 
	  that postgres will slow down when a large number of uncommited 
	  transactions have accumulated, and that one user found (in 
	  a completely dissimilar application) the sweet spot was in 
	  the low hundreds of transactions.  (For us each entr insert 
	  represents a half dozen or more transactions, so we may still 
	  be too high.)

	* showentr.py[1.6]
	Updated for consistency with jbdb.py[1.5] and tables.py[1.2].
	Use the new recursive Entr._read() method to initialize 
	  entry data rather than executing a bunch on sql statements.
	Move function load() into jbdb.py.

	* README.txt[1.3]
	Clarify alarming messages when running the reload.sql script.

2006-10-11	smcgraw@frii.com

	* load_jmdict.py[1.5]
	Propagate part-of-speech information to folowing senses in
	each entry.

	Remove the Def_enc global and the code that set if from locale.  
	It wasn't used, and if we need the encoding, we can get it from 
	sys.stdout.encoding.

2006-10-10	smcgraw@frii.com

	Tag R002: Posted to jmdict mailing list. 2006-10-10.

2006-10-10	smcgraw@frii.com

	Tag T004: Changes to suppport Postgresql in addition to Mysql.

	* Changes.txt pg/db.py mysql/db.py
	New files.

	* jbdb.py[1.4]
	Move Cursor class, function dbOpen() into pg/db.py and mysql/db.py.
	Instead of executing db-specific sql to get the last used auto-number
	  value, move that sql into new cursor method .lastauto() in each
	  of the db-specific db.py modules, and call it in jbdb.py.

	* load_jmdict.py[1.5]
	Get rid of mysql specific code.

	* loadkw.sql reload,sql schema.sql 
	Move into the database-specific directories pg/ and mysql/.

	* README.txt[1.2]
	Updated to include new info about postgresql, remove
	some old info no longer relevent.

	* mysql/schema.sql[1.1]
	Add view "entr_summary".

	* showentr.py[1.4]
	Get rid of mysql specific code.
	When printing glosses, explicitly convert to default encoding
	  so can use "replace" to avoid exception when an unconvertable
	  utf8 character encountered, as commonly happens with iso9959-x
	  characters when default encoding is something like sjis.
	Use query "entr_summary" to get matched entries list, rather
	  than doing the sql in the script.  **Note**: This results
	  in very long response times for the "find>" command when
	  using Mysql, because Mysql executes the view's sql without
	  any consideration of the outer WHERE clause!
	Drop the temp table before trying to create it.
	Conditionalize the sql executed to create the temp table for 
	  mysql or postgresql.

	* sitecustomize[1.2]
	It wasn't actually setting the default encoding. Fixed.

2006/10/09	smcgraw@frii.com

	Tags to date:
	T003	Last (I hope) Mysql-only files.
	T002	Files distributed on the jmdict mailing list, 2006/09/21.
	T001	Initial commit
