Title:	DB maintenance job
Stat:	open
Disp:	
Prio:	med
Cats:	dev
Reqtrs:	
AssdTo:	stuart

2007-02-01 00:00:00 stuart@friix.com
  database -- write maintenance scripts to check for things that are hard
  to write contraints for: do all senses have at least one gloss?  do all
  (jmdict) entries have at least one sense and reading?, Are
  rdng,kanj,sens,gloss ord numbers consecutive?
  Does each set of src/seq entries have at most one active approved entry?

  It may be useful to duplicate some of the input checking requested in
  IS-168 on database entries in case any sneak in by other routes.

  Need a cron job to delete D and R entries after some period of time.

2010-06-16 22:08:00 stuart
  JMdictDB being used for live updates by Jim Breen now, which means
  this issue is now much higher priority.

2010-07-23 12:41:00 stuart
  Here are some queries that can be used:
  <snipped since corrected tested queries now available.> 

2010-07-26 20:19:00 stuart
  Wrote two scripts, cccheck.py and reaper.py, which are not yet
  in the mercurial repo.  Send copies to jwb last night.  Besides
  local testing, I ran on Arakawa's jmdict database and behavior 
  was as expected.

  check.py runs several checks on the database data (15 currently
  although that number will grow I'm sure).  The messages in
  the source code describes them.  It changes nothing and takes
  only a few seconds so it is safe to run anytime.  The output
  in not pretty, mostly lists of entry ids (not seq#s) for entries 
  that have problems.  (Seems like that's ok because some of the 
  structural problems likely will require poking around with psql 
  to diagnose and fix, and one would hope for no output most of
  the time.)  Running it with --help will give more details.
  It is intended to be run from a cron job setup to mail output
  to someone.

  reaper.py is intended to be run from a cron job nightly or weekly
  or whatever.  It will look for deleted or rejected entries --age
  days (default 30) old or older and delete them after writing them
  in xml form to a log file that can be archived.  To play with it
  interactively, give it the -n option which will prevent it from 
  making any changes to the database.  It also has a --help option.

  These need to be run in a cron job so jwb and wfm need to set 
  up.  Waiting for feedback.

2010-07-26 21:16:00 stuart
  To-do: 

  Add option to limit checks to one (or a set of) corpus.  Maybe 
  use the --corpus option code from entrs2xml.py.  Remove the 
  corpus exclusions current wired into the sql.

  Add option to list available tests and test number so can figure
  out what test to run without looking at code.

  Separate the checks into two catagories: structural and content.

  Change the JIS gloss test to match current warnings in edconf.py:
  any character in range u+ff01 - u+ff5d.
