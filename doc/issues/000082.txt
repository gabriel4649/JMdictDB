Title:	Ordered xrefs
Stat:	closed
Disp:	done
Prio:	high
Cats:	dev
Reqtrs:	
AssdTo:	stuart@friix.com

2007-07-26 00:00:00 stuart@friix.com
  In email (2007/07/26 00:37) Jim Breen points out that the xrefs should
  be ordered:
  > 2163220 has xrefs to イケメン and 普通 (in that order) [but showentr.pl
  displays them in the reverse order].
  > (it might be a pain, but I think the JMdict order should be
  maintained.)
  
  Two ways to do:
  1) Add new smallint column "xref" to table xref, and make part of PK
  (entr,sens,xref).  This is exactly analogous to how order is done by the
  other tables (rdng, kanj, sens, gloss).
  
  2) Leave current PK alone and add an order column to be populated from
  the xresolv "order" column.  Because each xresolv row can expand to
  multiple xref rows, the xref order column may get dup values for the
  same source entr,sens.

2007-07-29 00:00:00 stuart@friix.com
  Implemented option 1).  Notes:
  
  Difficulty in assigning column "xref" values during load from xml data.
  The data for that load is generated by a SQL select statement and it is
  hard to generate the xref values in the select.  (Not a problem for
  rdng,sens,etc because those  have order values created by perl durning
  the xml parsing.)  Because each insert cause the trigger to do a SELECT
  MAX(...) it could be pretty slow when inserting a large number of xrefs
  (such as will happen when we resolve the Examples file xrefs).  Based on
  the time taken to insert the 3000 jmdict xrefs, estimate 1M examples
  file xrefs will take about 1.5 hr on my machine.
