Title:	Patch required for Ply-2.5 on Python-2.6
Stat:	closed
Disp:	done
Prio:	high
Cats:	dev
Reqtrs:	
AssdTo:	

2008-11-22 15:54:37 sysad
  When ply-2.5 (the yacc-ish parser generator we use for
  parsing JEL input) is run under Python-2.6, it generates
  a warning message to syserr:
  
    DeprecationWarning: the md5 module is deprecated; use
    hashlib instead
  
  Under Windows both stdout and stderr from cgi scripts is
  sent to the client browser.
  
  When edconf.py runs ply and the above message is produced,
  in ends up in a random place in the hlml of the edconf page,
  often in the base64 encoded serialized entry object text.
  This in turn causes the subsequent edsubmit.py page to fail
  when it tries to decode the corrupted serialization it receives
  from the edconf.py page.
  
  Note that ply writes other messages to stderr when a parse
  fails which will result in the same problem so a more general
  solution is needed (see IS-138), but the "depreciated" message
  above is produced every time under Python-2.6, and will clog
  the web server logs even on unix systems so a fix is desirable
  explicitly for it.

2008-11-22 21:16:00 sysad
  Fix by applying the following patch (from dhendriks, 16 Oct 2008)
    http://groups.google.com/group/ply-hack/browse_frm/thread/8f4fa3ecb40235fe
  to Ply's yacc.py file.
  
  ****** start of patch *********
  --- yacc.py
  +++ yacc.py
  @@ -71,7 +71,18 @@
   yaccdevel   = 0                # Set to True if developing yacc.
  This turns off optimized
                                  # implementations of certain
  functions.
  
  
  -import re, types, sys, cStringIO, md5, os.path
  +import re, types, sys, cStringIO, os.path
  +
  +# The hashlib module (new in Python 2.5) is preferred over the md5 module. The
  +# (old) md5 module is deprecated since Python 2.5.
  +try:
  +    import hashlib
  +    def new_md5():
  +        return hashlib.md5()
  +except ImportError:
  +    import md5
  +    def new_md5():
  +        return md5.new()
  
  
   # Exception raised for yacc-related errors
   class YaccError(Exception):   pass
  @@ -1156,7 +1167,7 @@
  
  
       Errorfunc    = None    # User defined error handler
  
  
  -    Signature    = md5.new()   # Digital signature of the grammar rules, precedence
  +    Signature    = new_md5()   # Digital signature of the grammar rules, precedence
                                  # and other information.  Used to determined when a
                                  # parsing table needs to be regenerated.
  ****** end of patch *********
