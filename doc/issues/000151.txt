Title:	Jmparse erroneously processing ampersand chars
Stat:	closed
Disp:	done
Prio:	crit
Cats:	dev
Reqtrs:	
AssdTo:	stuart

2009-07-04 18:26:00 stuart
  After a fresh load of jmdict into the database, noticed that
  entry seq 1206100 has gloss in sense 4:

    third degree (of the Japanese amp Chinese pentatonic scale)

  The "amp" should have been "&", and is correctly "&amp;" in
  the input jmdict XML file:

    <gloss>third degree (of the Japanese &amp; Chinese pentatonic scale)</gloss>

2009-07-11 23:14:00 stuart
  Change priority to "critical".  This problem also affects the angle
  brackets in the xml tags of the history diffs corrupting them to
  "lt" and "gt" and corrupting the diffs.

2009-07-11 23:14:00 stuart
  The xml file from which my personal corpora was loaded contains correctly
  encoded entities, however the .pgi file produced by jmparse exhibits the
  problem confirming that the problem is happrning in jmparse.
  For reference,the changes I recall making After the data load (and which 
  will need to be redone were:
    mnn chap 7 missing audio clips.
    mnn chap 7 missing entry and audio for itadakimasu.

2009-07-12 05:25:00 stuart
  Problem was in python/lib/jmxml.py in Jmdictfile.read() and also parse_entry()
  where I bone-headedly convert every entity (including &amp; and friends)
  to text -- what the h*** was I thinking?  Modify both places to convert as 
  before but except the four standard entities, &amp;, &lt;, &gt;, &quot;.  
  Not sure this is an adaquate solution (are there any others?  Do any of the 
  standard four come in any alternate forms?)  Might be better to convert only
  those entities that are defined in the DTD.  Will reconsider but not right 
  now.
