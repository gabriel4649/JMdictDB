Title:	Each corpus needs own seq number sequence 
Stat:	open
Disp:	
Prio:	med
Cats:	dev
Reqtrs:	
AssdTo:	stuart

2009-07-11 22:23:00 stuart
  Currently most of the corpora I've added in my personal jmdictdb
  installation share the same seq number generator sequence.  This
  led to the following problem:

  1) I edited a jmdict entry, saved in in my corpus jmdict-modified
     but kept it with the original jmdict seq number.

  2) I saved all my personal corpora, reloaded the database and restored
     my corpora.  

  3) The restore procedure resets the shared seq number generator sequence
     to the highest seq number used -- in this case the very large seq
     number on the entry in jmdict-modified.

  4) All subsequent entries in any of my personal corpora get assigned 
     seq number values above the large jmdict-modified entry seq value.

  I think the fix to this is to use independent sequence generators for 
  each corpus.  At a minimum, the jmdict-modified corpus needs its own
  sequence generator.

  See also related IS-143: Inconsistent seq# and dfrm leads to problems. 

2009-07-11 23:02:00 stuart
  For reference, I temporarily fixed the above described situation by;
  1) Get a list of the largest seq number used by entries that use 
     the 'seq' sequence generator for seq numbers.

     SELECT e.id,e.seq,k.kw
       FROM entr e
       JOIN kwsrc k ON k.id=e.src
       WHERE k.seq='seq' 
       ORDER BY e.seq DESC LIMIT 10;

  2) Manually reset the seq numbers on the entries with big seq numbers
     that aren't in jmdict-modified, e.g.:

     UPDATE entr SET seq=4033 WHERE id=1057726; 
     UPDATE entr SET seq=4034 WHERE id=1057732; 

  3) Reset the 'seq' sequence:

     SELECT SETVAL('seq',4034);
