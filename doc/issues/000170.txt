Title:	lexically sorted search results
Stat:   open
Disp:	
Prio:	med
Cats:	dev
Reqtrs:	
AssdTo:	stuart

2010-06-11 09:27:00 stuart
  On the edict mailing list yesterday, Jeroen Hoek suggested
  providing search results in lexical order. 

  To do this we we can either sort the srch results records
  within the srchres.py script, or get them in sorted order
  from the database by modifying the ORDER BY clause used on
  query the does the search.  Decided on the latter option
  because it requires fixing the database collation order
  which will allow japanese sorting to work in other places
  too.  (Currently we create the database with whatever
  locale the server happens to be using at the time.)
  This process is described in IS-171.

2010-06-11 09:27:00 stuart
  In python/cgi/srchres.py, the search query was modified by
  changing the ORDER BY clause from "seq,id" to
  "kanj,rdng,seq,id".  
  
  In srchres.py, the sql generated by the search form variable
  is joined with view "esum" which gives us access to its kanj
  and rdng fields.  These are what are displayed on the srchres
  page.  Although they include only the first kanji or reading
  in the entry, that is fine for sorting purposes I think. 

  Also modified entr.py to display multiple entries in sorted
  order but because entries are loaded from list of id or seq
  number by api call, we do the sort in Python in entr.py 
  rather than asking the database to return an ordered list.

  Finally, changed python/lib/tmpl/srchformq.tal to make
  "starts" the default text search type which was the original
  request that motivated these changes.

  However, I saw a potential problem after updating the
  database on my Fedora-11 test machine per IS-171 and
  testing the srchres page...
  Because the search will return any entry that has any kanji
  that starts with the sought text, it is possible that the 
  first kanji, on which the list is sorted, will appear above
  an entry that exactly matches.  That is, if one searches for
  kanji text starting with 食, the entry 植物油 (which was 
  found because it has an alternate kanji of 食物油) will 
  sort in front of 食 because 植 is less than 食.
