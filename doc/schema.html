<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
	<title></title>
	<meta name="generator" content="LibreOffice 4.3.6.2 (Linux)"/>
	<meta name="created" content="2002-07-15T12:38:53"/>
	<meta name="changed" content="2015-05-06T12:00:06.194992801"/>
	<meta name="Info 1" content=""/>
	<meta name="Info 2" content=""/>
	<meta name="Info 3" content=""/>
	<meta name="Info 4" content=""/>
	<meta name="sdendnote" content="ARABIC;;[;]">
	<style type="text/css">
		@page { size: 8.27in 11.69in; margin-left: 1.25in; margin-right: 1.25in; margin-top: 1in; margin-bottom: 0.5in }
		p { margin-bottom: 0.08in }
		h1 { margin-top: 0.17in; margin-bottom: 0.08in; page-break-before: always; page-break-after: auto }
		h1.western { font-family: "Thorndale", serif; font-size: 16pt }
		h1.cjk { font-size: 16pt }
		h1.ctl { font-size: 16pt }
		h2 { margin-top: 0.17in; margin-bottom: 0.08in }
		h2.western { font-family: "Thorndale", serif; font-size: 14pt; font-style: italic }
		h2.cjk { font-family: "Andale Sans UI"; font-size: 14pt; font-style: italic }
		h2.ctl { font-family: "Tahoma"; font-size: 14pt; font-style: italic }
		h4 { margin-top: 0.17in; color: #000000 }
		h4.western { font-family: "Thorndale", serif; font-size: 11pt; font-style: italic }
		h4.cjk { font-family: "Andale Sans UI"; font-size: 11pt; font-style: italic }
		h4.ctl { font-family: "Tahoma"; font-size: 11pt; font-style: italic }
		p.list-ctl { font-family: "Tahoma" }
		p.list-2-start-western { margin-left: 0.5in; text-indent: -0.25in; margin-bottom: 0.08in }
		p.list-2-start-cjk { margin-left: 0.5in; text-indent: -0.25in; margin-bottom: 0.08in }
		p.list-2-start-ctl { margin-left: 0.5in; text-indent: -0.25in; margin-bottom: 0.08in; font-family: "Tahoma" }
		td p { margin-bottom: 0.08in }
		p.sdfootnote { margin-left: 0.2in; text-indent: -0.2in; margin-bottom: 0.2in; font-size: 10pt }
		p.sdendnote { margin-left: 0.2in; text-indent: -0.2in; margin-bottom: 0.2in; background: transparent; font-size: 10pt; page-break-before: auto }
		a:link { color: #000000 }
		a.western:visited { so-language: en-US }
		a.cjk:visited { so-language: ja-JP }
		a.ctl:visited { so-language: en-US }
		samp.western { font-family: "Courier New", monospace; font-size: 9pt }
		samp.cjk { font-family: "DejaVu LGC Sans Mono", monospace }
		samp.ctl { font-family: "Courier New", monospace }
		kbd { font-family: "Courier New", monospace }
		a.sdfootnoteanc { font-size: 57% }
		a.sdendnoteanc { font-size: 57% }
	</style>
</head>
<body lang="en-US" link="#000000" dir="ltr">
<p align="center" style="margin-bottom: 0.2in"><font size="5" style="font-size: 20pt">A
Schema Representation of Jmdict</font></p>
<p align="center" style="margin-bottom: 0.2in; font-style: normal"><font size="3" style="font-size: 12pt">by
Stuart McGraw &lt;jmdictdb@mtneva.com&gt;</font></p>
<p style="margin-bottom: 0.2in">This note describes how JMdict
data[<a class="sdendnoteanc" name="sdendnote1anc" href="#sdendnote1sym"><sup>1</sup></a>]
is represented in the database developed for the JMdictDB project[<a class="sdendnoteanc" name="sdendnote2anc" href="#sdendnote2sym"><sup>2</sup></a>].
It assumes you understand the how the JMdict data is represented in
the JMdict XML file[<a class="sdendnoteanc" name="sdendnote3anc" href="#sdendnote3sym"><sup>3</sup></a>]
and the basics of relational database design.</p>
<p style="margin-bottom: 0.2in">Source code to create, load, and
access a JMdict database is available at the JMdictDB project
website[<a class="sdendnoteanc" name="sdendnote4anc" href="#sdendnote4sym"><sup>4</sup></a>].
 The current implementation uses Postgresql[<a class="sdendnoteanc" name="sdendnote5anc" href="#sdendnote5sym"><sup>5</sup></a>],
but the schema design attempts to avoid dependence on features unique
to Postgresql, so the schema should be implementable using other
relational database products after adjusting the scripts' syntax to
the appropriate flavor of SQL. 
</p>
<p style="margin-bottom: 0.2in">A relationship diagram of the
database is available in the file schema.png[<a class="sdendnoteanc" name="sdendnote6anc" href="#sdendnote6sym"><sup>6</sup></a>].</p>
<p style="margin-bottom: 0.2in">The scripts that create the database
(and are thus the ultimate authority regarding the schema) are
available in the source code distribution in directory pg/.   The
tables described in this document are created in mktables.sql. 
Foreign keys and indexes are defined in fkcreate.sql which is an
auto-generated file created by pg/Makefile.  The JMdict database also
includes a number of views, functions, and other database objects
that are not discussed in this paper but are defined in mkviews.sql. 
</p>
<div id="Table of Contents1" dir="ltr">
	<div id="Table of Contents1_Head" dir="ltr">
		<p style="margin-top: 0.17in; page-break-after: avoid"><font size="4" style="font-size: 16pt"><b>Table
		of Contents</b></font></p>
	</div>
	<p style="margin-bottom: 0in; page-break-before: auto">1. Overview	2</p>
	<p style="margin-left: 0.2in; margin-bottom: 0in">1.1.Parent/Child
	Tables and Primary/Foreign keys.	2</p>
	<p style="margin-left: 0.2in; margin-bottom: 0in">1.2.Keyword
	Tables	4</p>
	<p style="margin-left: 0.2in; margin-bottom: 0in">1.3.Keyword
	Lists	5</p>
	<p style="margin-left: 0.2in; margin-bottom: 0in">1.4.Restrictions:
	restr, stagr, stagk	5</p>
	<p style="margin-left: 0.2in; margin-bottom: 0in">1.5.ke_pri, re_pri
	Generalization	6</p>
	<p style="margin-left: 0.2in; margin-bottom: 0in">1.6.Cross-references	6</p>
	<p style="margin-left: 0.59in; margin-bottom: 0.2in">Unresolved
	cross-references	7</p>
	<p style="margin-left: 0.2in; margin-bottom: 0in">1.7.Corpora and
	Sequence Numbers	7</p>
	<p style="margin-left: 0.2in; margin-bottom: 0in">1.8.XML
	Round-tripping	8</p>
	<p style="margin-bottom: 0in; page-break-before: auto">2. An Example
	Entry	10</p>
	<p style="margin-bottom: 0in; page-break-before: auto">3.Using
	SQL	14</p>
	<p style="margin-left: 0.2in; margin-bottom: 0in">3.1.Retrieving an
	Entry's Data	14</p>
	<p style="margin-left: 0.2in; margin-bottom: 0in">3.2.Finding
	Entries	15</p>
	<p style="margin-left: 0.2in; margin-bottom: 0in">3.3.Views	15</p>
	<p style="margin-bottom: 0in; page-break-before: auto">4. Annotated
	Schema	17</p>
</div>
<p style="margin-bottom: 0.2in"><br/>
<br/>

</p>
<ol>
	<li/>
<h1 class="western"> Overview</h1>
</ol>
<p style="margin-bottom: 0.2in">Roughly, each element type in the
JMdict XML is modeled by a separate table in the database.  The
hierarchical structure of the XML is mirrored by the tables being
linked in parent-child relationships using foreign keys in child
tables that refer to the primary keys of parent tables.  Table <i><u>entr</u></i>
is at the top of the hierarchy and each row in <i><u>entr</u></i>
corresponds to an &lt;entry&gt; element in the JMdict XML.  
</p>
<p style="margin-bottom: 0.2in">The correspondence of tables and
JMdict XML elements is not absolute however; in some cases where no
more than one sub-element is possible, the sub-element's information
may be contained in a column of the table corresponding to the
containing element.  In some cases the JMdict XML semantics have been
modified to better fit relational data semantics, or to allow more
representational capabilities.</p>
<ol>
	<ol>
		<li/>
<h2 class="western">Parent/Child Tables and Primary/Foreign
		keys.</h2>
	</ol>
</ol>
<p style="margin-bottom: 0.2in">Each JMdict entry is represented by a
row in table <i><u>entr</u></i> and each row has a integer field <i><span style="text-decoration: none"><span style="background: transparent">id</span></span></i>
containing an arbitrary but unique integer that identifies the row
(and the entry). Each <i><u>entr</u></i> row contains some
information about its entry, but most of the entry's information (for
example readings or senses) is in other tables connected to the <i><u>entr</u></i>
table by primary key / foreign key relationships.</p>
<p style="margin-bottom: 0.2in">Each of these &quot;child&quot;
tables has a column <i><span style="text-decoration: none"><span style="background: transparent">entr</span></span></i>
that is a foreign key to the primary key column <i><span style="text-decoration: none"><span style="background: transparent">id</span></span></i>
in their parent table, <i><u>entr</u></i> (abbreviated <i><span style="text-decoration: none"><span style="background: transparent">entr.id</span></span></i>).
 It is primary key / foreign key relations like this that tie
together all the information for a single entry even though that
information is distributed over multiple tables. In addition, the
child tables of <i><u>entr</u></i> have another column, usually given
the same name as the table itself, whose value is a small integer
that serves to both disambiguate the child table's rows within the
entry, and to order them. Thus, the table <i><u>sens</u></i> has two
columns, <i><span style="text-decoration: none"><span style="background: transparent">entr</span></span></i>,
and <i><span style="text-decoration: none"><span style="background: transparent">sens</span></span></i>,
and all rows representing senses of a given entry will have the same
value in the <i><span style="text-decoration: none"><span style="background: transparent">entr</span></span></i>
field, and values like 1, 2, 3, etc, in the <i><span style="text-decoration: none"><span style="background: transparent">sens</span></span></i>
field. The <i><span style="text-decoration: none"><span style="background: transparent">entr</span></span></i>
and <i><span style="text-decoration: none"><span style="background: transparent">sens</span></span></i>
columns together form the primary key of the <i><u>sens</u></i>
table.</p>
<p style="margin-bottom: 0.2in">Some of the child tables in turn have
their own child tables. The table <i><u>gloss</u></i> is a child
table of <i><u>sens</u></i>. It has columns <i><span style="text-decoration: none"><span style="background: transparent">entr</span></span></i>
and <i><span style="text-decoration: none"><span style="background: transparent">sens</span></span></i>
which relate its rows to particular senses in table <i><u>sens</u></i>,
and a column <i><span style="text-decoration: none"><span style="background: transparent">gloss</span></span></i>
to disambiguate and order the glosses within each sense. The table's
primary key consists of the columns <i><span style="text-decoration: none"><span style="background: transparent">entr</span></span></i>,
<i><span style="text-decoration: none"><span style="background: transparent">sens</span></span></i>,
<i><span style="text-decoration: none"><span style="background: transparent">gloss</span></span></i>.</p>
<p style="margin-bottom: 0.2in">The <i><span style="text-decoration: none"><span style="background: transparent">entr.id</span></span></i>
numbers are used by the database to connect rows to related rows in
other tables.  They can change over time and will probably be
different in different database instances, and thus should never be
saved outside the database as row identifiers.</p>
<p style="margin-bottom: 0.2in">The following table shows the
database tables as a hierarchy with parent-child relationships
denoted by indentation of the table names:</p>
<p style="margin-bottom: 0.2in"><br/>
<br/>

</p>
<table width="100%" cellpadding="4" cellspacing="0" style="page-break-after: avoid">
	<col width="53*">
	<col width="72*">
	<col width="131*">
	<tr valign="top">
		<td width="21%" style="border-top: 1px solid #000000; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0.04in; padding-bottom: 0.04in; padding-left: 0.04in; padding-right: 0in">
			<p><b>Database table name</b></p>
		</td>
		<td width="28%" style="border-top: 1px solid #000000; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0.04in; padding-bottom: 0.04in; padding-left: 0.04in; padding-right: 0in">
			<p><b>JMdict XML element</b></p>
		</td>
		<td width="51%" style="border: 1px solid #000000; padding: 0.04in">
			<p><b>Information</b></p>
		</td>
	</tr>
	<tr valign="top">
		<td width="21%" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0in; padding-bottom: 0.04in; padding-left: 0.04in; padding-right: 0in">
			<p><b>entr</b></p>
		</td>
		<td width="28%" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0in; padding-bottom: 0.04in; padding-left: 0.04in; padding-right: 0in">
			<p>&lt;entr&gt;</p>
		</td>
		<td width="51%" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; padding-top: 0in; padding-bottom: 0.04in; padding-left: 0.04in; padding-right: 0.04in">
			<p>Entries</p>
		</td>
	</tr>
	<tr valign="top">
		<td width="21%" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0in; padding-bottom: 0.04in; padding-left: 0.04in; padding-right: 0in">
			<p>&nbsp;&nbsp;&nbsp;&nbsp;<b>hist</b></p>
		</td>
		<td width="28%" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0in; padding-bottom: 0.04in; padding-left: 0.04in; padding-right: 0in">
			<p>&lt;audit&gt;</p>
		</td>
		<td width="51%" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; padding-top: 0in; padding-bottom: 0.04in; padding-left: 0.04in; padding-right: 0.04in">
			<p>Entry change history</p>
		</td>
	</tr>
	<tr valign="top">
		<td width="21%" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0in; padding-bottom: 0.04in; padding-left: 0.04in; padding-right: 0in">
			<p>&nbsp;&nbsp;&nbsp;&nbsp;<b>kanj</b></p>
		</td>
		<td width="28%" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0in; padding-bottom: 0.04in; padding-left: 0.04in; padding-right: 0in">
			<p>&lt;ke_ele&gt;, &lt;keb&gt;</p>
		</td>
		<td width="51%" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; padding-top: 0in; padding-bottom: 0.04in; padding-left: 0.04in; padding-right: 0.04in">
			<p>Kanji text</p>
		</td>
	</tr>
	<tr valign="top">
		<td width="21%" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0in; padding-bottom: 0.04in; padding-left: 0.04in; padding-right: 0in">
			<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>kinf</b></p>
		</td>
		<td width="28%" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0in; padding-bottom: 0.04in; padding-left: 0.04in; padding-right: 0in">
			<p>&lt;ke_inf&gt;</p>
		</td>
		<td width="51%" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; padding-top: 0in; padding-bottom: 0.04in; padding-left: 0.04in; padding-right: 0.04in">
			<p>Kanji supplementary info</p>
		</td>
	</tr>
	<tr valign="top">
		<td width="21%" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0in; padding-bottom: 0.04in; padding-left: 0.04in; padding-right: 0in">
			<p>&nbsp;&nbsp;&nbsp;&nbsp;<b>rdng</b></p>
		</td>
		<td width="28%" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0in; padding-bottom: 0.04in; padding-left: 0.04in; padding-right: 0in">
			<p>&lt;re_ele&gt;, &lt;reb&gt;</p>
		</td>
		<td width="51%" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; padding-top: 0in; padding-bottom: 0.04in; padding-left: 0.04in; padding-right: 0.04in">
			<p>Reading (kana) text</p>
		</td>
	</tr>
	<tr valign="top">
		<td width="21%" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0in; padding-bottom: 0.04in; padding-left: 0.04in; padding-right: 0in">
			<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>rinf</b></p>
		</td>
		<td width="28%" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0in; padding-bottom: 0.04in; padding-left: 0.04in; padding-right: 0in">
			<p>&lt;re_inf&gt;</p>
		</td>
		<td width="51%" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; padding-top: 0in; padding-bottom: 0.04in; padding-left: 0.04in; padding-right: 0.04in">
			<p>Reading supplementary info</p>
		</td>
	</tr>
	<tr valign="top">
		<td width="21%" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0in; padding-bottom: 0.04in; padding-left: 0.04in; padding-right: 0in">
			<p>&nbsp;&nbsp;&nbsp;&nbsp;<b>sens</b></p>
		</td>
		<td width="28%" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0in; padding-bottom: 0.04in; padding-left: 0.04in; padding-right: 0in">
			<p>&lt;sense&gt;, &lt;s_info&gt;</p>
		</td>
		<td width="51%" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; padding-top: 0in; padding-bottom: 0.04in; padding-left: 0.04in; padding-right: 0.04in">
			<p>Sense 
			</p>
		</td>
	</tr>
	<tr valign="top">
		<td width="21%" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0in; padding-bottom: 0.04in; padding-left: 0.04in; padding-right: 0in">
			<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>pos</b></p>
		</td>
		<td width="28%" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0in; padding-bottom: 0.04in; padding-left: 0.04in; padding-right: 0in">
			<p>&lt;pos&gt;</p>
		</td>
		<td width="51%" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; padding-top: 0in; padding-bottom: 0.04in; padding-left: 0.04in; padding-right: 0.04in">
			<p>Part-of speech</p>
		</td>
	</tr>
	<tr valign="top">
		<td width="21%" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0in; padding-bottom: 0.04in; padding-left: 0.04in; padding-right: 0in">
			<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>misc</b></p>
		</td>
		<td width="28%" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0in; padding-bottom: 0.04in; padding-left: 0.04in; padding-right: 0in">
			<p>&lt;misc&gt;</p>
		</td>
		<td width="51%" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; padding-top: 0in; padding-bottom: 0.04in; padding-left: 0.04in; padding-right: 0.04in">
			<p>Misc. sense info</p>
		</td>
	</tr>
	<tr valign="top">
		<td width="21%" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0in; padding-bottom: 0.04in; padding-left: 0.04in; padding-right: 0in">
			<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>fld</b></p>
		</td>
		<td width="28%" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0in; padding-bottom: 0.04in; padding-left: 0.04in; padding-right: 0in">
			<p>&lt;field&gt;</p>
		</td>
		<td width="51%" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; padding-top: 0in; padding-bottom: 0.04in; padding-left: 0.04in; padding-right: 0.04in">
			<p>Field of use</p>
		</td>
	</tr>
	<tr valign="top">
		<td width="21%" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0in; padding-bottom: 0.04in; padding-left: 0.04in; padding-right: 0in">
			<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>gloss<a class="sdfootnoteanc" name="sdfootnote1anc" href="#sdfootnote1sym"><sup>1</sup></a></b></p>
		</td>
		<td width="28%" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0in; padding-bottom: 0.04in; padding-left: 0.04in; padding-right: 0in">
			<p>&lt;gloss&gt;</p>
		</td>
		<td width="51%" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; padding-top: 0in; padding-bottom: 0.04in; padding-left: 0.04in; padding-right: 0.04in">
			<p>English and other language translations</p>
		</td>
	</tr>
	<tr valign="top">
		<td width="21%" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0in; padding-bottom: 0.04in; padding-left: 0.04in; padding-right: 0in">
			<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>dial</b></p>
		</td>
		<td width="28%" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0in; padding-bottom: 0.04in; padding-left: 0.04in; padding-right: 0in">
			<p>&lt;dial&gt;</p>
		</td>
		<td width="51%" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; padding-top: 0in; padding-bottom: 0.04in; padding-left: 0.04in; padding-right: 0.04in">
			<p>Dialect</p>
		</td>
	</tr>
	<tr valign="top">
		<td width="21%" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0in; padding-bottom: 0.04in; padding-left: 0.04in; padding-right: 0in">
			<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>lsrc</b></p>
		</td>
		<td width="28%" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0in; padding-bottom: 0.04in; padding-left: 0.04in; padding-right: 0in">
			<p>&lt;lsource&gt;</p>
		</td>
		<td width="51%" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; padding-top: 0in; padding-bottom: 0.04in; padding-left: 0.04in; padding-right: 0.04in">
			<p>Source language and word</p>
		</td>
	</tr>
	<tr>
		<td colspan="3" width="100%" height="64" valign="top" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; padding-top: 0in; padding-bottom: 0.04in; padding-left: 0.04in; padding-right: 0.04in">
			<p><br/>
<br/>

			</p>
			<p>There are some tables that have two parents and thus don't fit
			neatly into the hierarchical picture above:</p>
		</td>
	</tr>
	<tr valign="top">
		<td width="21%" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0in; padding-bottom: 0.04in; padding-left: 0.04in; padding-right: 0in">
			<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>restr</b></p>
		</td>
		<td width="28%" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0in; padding-bottom: 0.04in; padding-left: 0.04in; padding-right: 0in">
			<p style="font-style: normal; font-weight: normal">&lt;restr&gt;</p>
		</td>
		<td width="51%" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; padding-top: 0in; padding-bottom: 0.04in; padding-left: 0.04in; padding-right: 0.04in">
			<p style="font-style: normal; font-weight: normal">Invalid
			reading-kanji pairs. [parents: (<i><u>rdng</u></i>, <i><u>kanj</u></i>)]</p>
		</td>
	</tr>
	<tr valign="top">
		<td width="21%" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0in; padding-bottom: 0.04in; padding-left: 0.04in; padding-right: 0in">
			<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>stagr</b></p>
		</td>
		<td width="28%" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0in; padding-bottom: 0.04in; padding-left: 0.04in; padding-right: 0in">
			<p>&lt;stagr&gt;</p>
		</td>
		<td width="51%" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; padding-top: 0in; padding-bottom: 0.04in; padding-left: 0.04in; padding-right: 0.04in">
			<p>Invalid sense-reading pairs. [parents: (<i><u>sens</u></i>,
			<i><u>rdng</u></i>)]</p>
		</td>
	</tr>
	<tr valign="top">
		<td width="21%" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0in; padding-bottom: 0.04in; padding-left: 0.04in; padding-right: 0in">
			<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>stagk</b></p>
		</td>
		<td width="28%" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0in; padding-bottom: 0.04in; padding-left: 0.04in; padding-right: 0in">
			<p>&lt;stagk&gt;</p>
		</td>
		<td width="51%" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; padding-top: 0in; padding-bottom: 0.04in; padding-left: 0.04in; padding-right: 0.04in">
			<p>Invalid sens-kanji pairs. [parents: (<i><u>sens</u></i>, <i><u>kanj</u></i>)]</p>
		</td>
	</tr>
	<tr valign="top">
		<td width="21%" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0in; padding-bottom: 0.04in; padding-left: 0.04in; padding-right: 0in">
			<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>freq</b></p>
		</td>
		<td width="28%" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0in; padding-bottom: 0.04in; padding-left: 0.04in; padding-right: 0in">
			<p>&lt;re_pri&gt;, &lt;ke_pri&gt;</p>
		</td>
		<td width="51%" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; padding-top: 0in; padding-bottom: 0.04in; padding-left: 0.04in; padding-right: 0.04in">
			<p>Frequency-of-use info for reading-kanji pairs. [parents: (<i><u>rdng</u></i>,
			<i><u>kanj</u></i>)]</p>
		</td>
	</tr>
	<tr valign="top">
		<td width="21%" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0in; padding-bottom: 0.04in; padding-left: 0.04in; padding-right: 0in">
			<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>xref</b></p>
		</td>
		<td width="28%" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0in; padding-bottom: 0.04in; padding-left: 0.04in; padding-right: 0in">
			<p>&lt;xref&gt;, &lt;ant&gt;</p>
		</td>
		<td width="51%" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; padding-top: 0in; padding-bottom: 0.04in; padding-left: 0.04in; padding-right: 0.04in">
			<p>Cross-references to other entries. [parents: (<i><u>sens</u></i>,
			<i><u>sens</u></i>)]</p>
		</td>
	</tr>
</table>
<p style="margin-top: 0.08in"><font size="2" style="font-size: 10pt"><i>Table
1: Entr database tables hierarchy</i></font></p>
<p style="margin-bottom: 0.2in"><br>The <i><u>restr</u></i> table,
for example, contains information about invalid combinations of
readings and kanji and therefore needs to reference rows in both of
the tables <i><u>rdng</u></i> and <i><u>kanj</u></i>. The primary
keys of those two tables are (<i><span style="text-decoration: none"><span style="background: transparent">entr,rdng</span></span></i>)
and (<i><span style="text-decoration: none"><span style="background: transparent">entr,kanj</span></span></i>)
respectively. Since the referenced readings and kanji are always in
the same entry, the <i><u>restr</u></i> table need only reference the
entr column once, so the columns in <i><u>restr</u></i> will be
(<i><span style="text-decoration: none"><span style="background: transparent">entr,rdng,kanj</span></span></i>)
and its foreign keys are (<i><span style="text-decoration: none"><span style="background: transparent">entr,rdng</span></span></i>)
and (<i><span style="text-decoration: none"><span style="background: transparent">entr,kanj</span></span></i>).
 The <i><u>stagr</u></i> and <i><u>stagk</u></i> tables are similar.</p>
<p style="margin-bottom: 0.2in">The table <i><u>xref</u></i> also has
two parents, both senses. The first is the sense the cross-reference
is from, and the second, the sense (in a different entry) the
cross-reference is to. Because the senses exist in different entries,
the <i><u>xref</u></i> table uses the columns (<i><span style="text-decoration: none"><span style="background: transparent">entr</span></span></i>,<i><span style="text-decoration: none"><span style="background: transparent">sens</span></span></i>,<i><span style="text-decoration: none"><span style="background: transparent">xentr</span></span></i>,<i><span style="text-decoration: none"><span style="background: transparent">xsens</span></span></i>)
to form the foreign keys (<i><span style="text-decoration: none"><span style="background: transparent">entr,sens</span></span></i>)
and (<i><span style="text-decoration: none"><span style="background: transparent">xentr,xsens</span></span></i>)
for the &quot;from&quot; and &quot;to&quot; senses respectively.</p>
<ol>
	<ol start="2">
		<li/>
<h2 class="western">Keyword Tables</h2>
	</ol>
</ol>
<p style="margin-bottom: 0.2in">In the JMdict XML file, XML entities
and abbreviations are used to encode reoccurring text strings. For
example the entity &quot;&amp;io;&quot; stands for &quot;io&quot;,
and its longer form, &quot;irregular okurigana usage&quot;.</p>
<p style="margin-bottom: 0.2in">In the database, small integers are
used for this purpose.  Each set of related keywords is placed in its
own table, and other tables that need to refer to a keyword store the
appropriate id number. The keyword tables are all named with the
prefix &quot;kw&quot; and we sometimes collectively refer to them as
&quot;the kw* tables&quot;. (Such tables are also sometimes called
&quot;lookup tables&quot; in database literature.)  We also use the
words “keyword” and “tag” somewhat interchangeably, although
the former tends to occur in the context of the database, and the
latter in the context of the JMdict XML.\</p>
<p style="margin-bottom: 0.2in">Here are the contents of the <i><u>kwkinf</u></i>
table, which contains the keywords used in the <i><u>kinf</u></i>
table (which in turn corresponds to the &lt;ke_inf&gt; elements in
the JMdict XML file).</p>
<p style="margin-bottom: 0.2in; background: #e6e6ff; border: 1px solid #000000; padding: 0.02in; page-break-inside: avoid; widows: 0; orphans: 0; page-break-before: auto; page-break-after: avoid">
<font face="Courier New, monospace"><font size="2" style="font-size: 9pt"><kbd><font size="2" style="font-size: 9pt">select
* from kwkinf;<br>id | kw |
descr<br>---+----+---------------------------------------<br>1&nbsp;&nbsp;|
iK | word containing irregular kanji usage<br>2&nbsp;&nbsp;| io |
irregular okurigana usage<br>3&nbsp;&nbsp;| oK | word containing
out-dated kanji<br>4&nbsp;&nbsp;| ik | word containing irregular kana
usage</font></kbd></font></font></p>
<p style="margin-bottom: 0.2in">kw* tables that correspond to
entities and abbreviations used in JMdict xml are: <i><u>kwdial</u></i>,
<i><u>kwfld</u></i>, <i><u>kwfreq</u></i>, <i><u>kwkinf</u></i>,
<i><u>kwlang</u></i>, <i><u>kwmisc</u></i>, <i><u>kwpos</u></i>,
<i><u>kwrinf</u></i>.  There are several kw* tables that don't
correspond to anything in JMdict: <i><u>kwsrc</u></i>, <i><u>kwstat</u></i>,
<i><u>kwxref</u></i>.</p>
<p style="margin-bottom: 0.2in">The keyword tables' primary function
is to enforce the use of valid keyword values in other tables by
means of referential integrity.  For this purpose only the values in
the keyword tables' <i><span style="text-decoration: none"><span style="background: transparent">id</span></span></i>
columns are significant.  The <i><span style="text-decoration: none"><span style="background: transparent">kw</span></span></i>
and <i><span style="text-decoration: none"><span style="background: transparent">descr</span></span></i>
texts are available for the use of applications to use for display,
but applications are free to map their own texts to the keyword id
numbers.</p>
<p style="margin-bottom: 0.2in">The keyword tables are colored green
in the schema diagram.</p>
<ol>
	<ol start="3">
		<li/>
<h2 class="western">Keyword Lists</h2>
	</ol>
</ol>
<p style="margin-bottom: 0.2in">Some information in JMdict and the
database is essentially lists of keywords. For example, a kanji text
might have one of more keywords from the <i><u>kinf</u></i> table
attached to it. These lists are stored in tables that have a foreign
key to the table with the elements the list is attached to, and a
foreign key to the appropriate keyword table. For example table <i><u>kinf</u></i>
holds the ke_inf tags for the kanji elements. It has columns (<i><span style="text-decoration: none"><span style="background: transparent">entr,
kanj, ord, kw</span></span></i>).  <i><span style="text-decoration: none"><span style="background: transparent">entr</span></span></i>
and <i><span style="text-decoration: none"><span style="background: transparent">kanj</span></span></i>
together identify a specific kanji element that a keyword applies to,
and <i><span style="text-decoration: none"><span style="background: transparent">kw</span></span></i>
identifies the appropriate ke_inf keyword in table <i><span style="text-decoration: none"><span style="background: transparent">kwkinf</span></span></i>.
The <i><span style="text-decoration: none"><span style="background: transparent">ord</span></span></i>
column contains a small integer and is used to maintain the order of
the items in the list.</p>
<p style="margin-bottom: 0.2in">A few keyword list tables have some
other information in addition to the keywords.  The table <i><u>freq</u></i>
for example contains freq keywords, and also a numeric value
associated with each.  
</p>
<p style="margin-bottom: 0.2in">The tables that contain such keyword
lists are: <i><u>dial</u></i>, <i><u>fld</u></i>, <i><u>freq</u></i>,
<i><u>kinf</u></i>, <i><u>misc</u></i>, <i><u>pos</u></i>, <i><u>rinf</u></i>.
</p>
<p style="margin-bottom: 0.2in">Not all references to the kw* tables
occur from these keyword list tables though. In some cases where only
one instance of a tag is possible, a reference may occur from one of
the other tables. For example, the <i><u>gloss</u></i> table contains
a column <i><span style="text-decoration: none"><span style="background: transparent">lang</span></span></i>
that references <i><u>kwlang</u></i>, This is appropriate since a
gloss can never have more than one language tag.</p>
<p style="margin-bottom: 0.2in">The use of integers rather that the
short text strings for keywords might seem cumbersome initially, but
in practice, one quickly learns the equivalences. This separation
allows the short and long text, which is really only relevant for
display to users, to change, while the numeric id values, relevant to
application code, remain invariant. Application code seldom needs to
execute joins with the kw* tables, because they will usually read the
keyword tables into memory at startup and resolve numeric id's to
strings (and the reverse) programmatically using the in-memory
tables. Finally, if one really does want to work with the text
strings in joins, it is easy to define views on the keyword list
tables that have the kw* tables pre-joined and present an additional
column containing the keyword text.</p>
<p style="margin-bottom: 0.2in">The keyword list tables are colored
yellow in the schema diagram.</p>
<ol>
	<ol start="4">
		<li/>
<h2 class="western">Restrictions: <i><u>restr</u></i>, <i><u>stagr</u></i>,
		<i><u>stagk</u></i></h2>
	</ol>
</ol>
<p style="margin-bottom: 0.2in">In the JMdict XML file, these
elements describe restrictions on the use of reading-kanji,
sense-reading, and sense-kanji (respectively) pairs by enumerating
the <em>valid</em> pairs.  
</p>
<p style="margin-bottom: 0.2in">In the database, those restrictions
are given by listing <em>invalid</em> pairs. Although this creates an
impedance mismatch when displaying such information (which will
generally be displayed as valid combinations), it is more consistent,
simplifies queries that incorporate this information, and eliminates
the need for explicitly representing related information such as the
&lt;re_nokanji&gt; element.</p>
<p style="margin-bottom: 0.2in">The restriction tables are colored
light blue in the schema diagram.</p>
<ol>
	<ol start="5">
		<li/>
<h2 class="western">ke_pri, re_pri Generalization</h2>
	</ol>
</ol>
<p style="margin-bottom: 0.2in">The ke_pri and re_pri elements in the
JMdict XML are used to convey information about frequency-of-use
metrics using values such as &quot;ichi1&quot;, &quot;ichi2&quot;,
&quot;ns14&quot;, etc.  Rather than mimicking JMdict's keyword based
approach, the database schema generalizes the notion of
frequency-of-use by using a scale indicator such as &quot;ichi&quot;
or &quot;nf&quot;, and a metric such as &quot;1&quot;, &quot;14&quot;,
etc. Thus &quot;ichi1&quot; is replaced by the keyword, value pair
(&quot;ichi&quot;,1) and &quot;nf14&quot; by (&quot;nf&quot;,14). 
This allows for the inclusion of other finer-grained metrics in the
future such as page counts from Internet search engines like Google.</p>
<p style="margin-bottom: 0.2in">Most ke_pri and re_pri elements in
JMdict xml occur as equi-valued pairs, that is there might be a
ke_pri element with the value &quot;nf32&quot; on a particular kanji
element, and a re_pri tag also with the value &quot;nf32&quot; on a
particular reading element. The equal values imply that the
frequency-of-use indicator refers to the tagged kanji and reading as
a pair, not to each independently. There are some ke_pri or re_pri
that are not paired and they apply to the kanji or reading alone. 
</p>
<p style="margin-bottom: 0.2in">In the database we represent ke_pri
and re_pri elements in table <i><u>freq</u></i>. Each row contains
columns <i><span style="text-decoration: none"><span style="background: transparent">rdng</span></span></i>
and <i><span style="text-decoration: none"><span style="background: transparent">kanj</span></span></i>
which references a reading and a kanji, thus a single row represents
a reading-kanji pair. Either (but not both) may be NULL should the
value apply to a reading or kanji alone.  Two other columns are <i><span style="text-decoration: none"><span style="background: transparent">kw</span></span></i>
which identifies the scale (by referring to table <i><u>kwfreq</u></i>),
e.g. &quot;nf&quot;, and <i><span style="text-decoration: none"><span style="background: transparent">value</span></span></i>
that gives the metric, e.g. 34, on the scale.</p>
<ol>
	<ol start="6">
		<li/>
<h2 class="western">Cross-references</h2>
	</ol>
</ol>
<p style="margin-bottom: 0.2in">In the JMdict XML file, there are two
kinds of cross references, &lt;xref&gt; (&quot;see also&quot;) and
&lt;ant&gt; (&quot;antonym&quot;). Both are located within senses,
and specify the target of the cross-ref as a kanji or reading text
string. This effects sense<font face="DejaVu LGC Sans, sans-serif">→</font>entry
cross references, and, since there is no guarantee that a kanji or
reading string will uniquely identify a single entry, may also be a
one-to-many reference.</p>
<p style="margin-bottom: 0.2in">In the database both (and possibly
other) kinds of cross references are modeled in table <i><u>xref</u></i>.
As in JMdict XML, cross references occur within senses, which is
represented in the <i><u>xref</u></i> table using columns <i><span style="text-decoration: none"><span style="background: transparent">entr</span></span></i>
and <i><span style="text-decoration: none"><span style="background: transparent">sens</span></span></i>
to identify the originating sense. Since the order of xrefs is
significant, the column <i><span style="text-decoration: none"><span style="background: transparent">xref</span></span></i>
orders the xrefs in a sense and the columns <i><span style="text-decoration: none"><span style="background: transparent">entr</span></span></i>,<i><span style="text-decoration: none"><span style="background: transparent">sens</span></span></i>,<i><span style="text-decoration: none"><span style="background: transparent">xref</span></span></i>
constitute the table's primary key.  Differing from JMdict XML, the
<i><u>xref</u></i> table gives the target of the cross-reference as a
another entry-sense pair, <i><span style="text-decoration: none"><span style="background: transparent">xentr</span></span></i>
and <i><span style="text-decoration: none"><span style="background: transparent">xsens</span></span></i>
which results in each cross-reference pointing to a specific sense in
one specific entry rather than an entire entry (or set of entries). 
If  a cross-reference to multiple senses or multiple entries is
wanted, multiple rows in the xref table are used.  Table <i><u>xref</u></i>
also has a column <i><span style="text-decoration: none"><span style="background: transparent">typ</span></span></i>
that gives the type of cross-ref, and whose values are defined in
table <i><u>kwxref</u></i>.</p>
<p style="margin-bottom: 0.2in">It is often desirable to display a
cross-reference using a reading and kanji other than the entry's
first reading and kanji.  The columns <i><span style="text-decoration: none"><span style="background: transparent">rdng</span></span></i>
and <i><span style="text-decoration: none"><span style="background: transparent">kanj</span></span></i>
point to the most appropriate values for display. 
</p>
<p style="margin-bottom: 0.2in">The cross reference table is colored
purple in the schema diagram.</p>
<h4 class="western">Unresolved cross-references</h4>
<p align="left" style="margin-bottom: 0.2in">There is no guarantee
that an an entry matching an XML &lt;xref&gt; or &lt;ant&gt; element
exists in the XML file or database. This is often the case when
loading XML data into the database when the entry referred to has not
been read yet.  Nor is there any guarantee that an &lt;xref&gt; or
&lt;ant&gt; element uniquely identifies a single entry – it could
match several.</p>
<p align="left" style="margin-bottom: 0.2in">The database schema
therefore provides a table, <i><u>xresolv</u></i>, which is used for
“unresolved” cross references into which cross reference items
are inserted when initially loading XML data.  After the data has
been loaded, a second program, xresolv.py, is run which will attempt
to identify a single entry that each row in <i><u>xresolv</u></i>
refers to, create one or more rows in table xref pointing to it, and
delete the row from table <i><u>xresolv</u></i>.  Unresolvable
(because there are no or multiple matching entries) xrefs are left in
table <i><u>xresolv</u></i> after xresolv.py completes.</p>
<ol>
	<ol start="7">
		<li/>
<h2 class="western">Corpora and Sequence Numbers</h2>
	</ol>
</ol>
<p style="margin-bottom: 0.2in">As mentioned, each entry (row in
table <i><u>entr</u></i>) has a unique id number that is (usually)
automatically assigned when an entry is created and uniquely
identifies the entry within the database.  Entries are also
identified by their corpus (<i><span style="text-decoration: none"><span style="background: transparent">entr.src</span></span></i>)
and sequence number (<i><span style="text-decoration: none"><span style="background: transparent">entr.seq</span></span></i>).
 This pair though may not be unique since there may be several such
entries when edited copies of an entry are created.  However, there
will be at most one such entry that is “approved” (has a
<i><span style="text-decoration: none"><span style="background: transparent">entr.unap</span></span></i>
value that is False) and normally only approved entries are exported
into XML.</p>
<p style="margin-bottom: 0.2in">The corpora to which entries are
assigned are defined in table <i><u>kwsrc</u></i>.  Each corpus has
some other attributes such as a short abbreviation (<i><span style="text-decoration: none"><span style="background: transparent">.kw</span></span></i>),
a long description (<i><span style="text-decoration: none"><span style="background: transparent">.descr</span></span></i>)
and a “type” (<i><span style="text-decoration: none"><span style="background: transparent">.srct</span></span></i>)
which is a reference to table <i><u>kwsrct</u></i> and associates
corpora into groups that have certain shared requirements for things
like display or editing. 
</p>
<p style="margin-bottom: 0.2in">Sequence numbers are automatically
assigned when an <i><u>entr</u></i> row is created without an
explicit seq number assigned.  This is done by Postgresql trigger. 
Each corpus has its own sequence number generator that is implemented
as a Postgresql sequence.<a class="sdfootnoteanc" name="sdfootnote2anc" href="#sdfootnote2sym"><sup>2</sup></a>
 The trigger will look in <i><span style="text-decoration: none"><span style="background: transparent">kwsrc.seq</span></span></i>
for the name of the Postgresql sequence to use to get the next
available sequence number for the corpus the entry belongs to.</p>
<p style="margin-bottom: 0.2in">There is also a trigger on the <i><u>kwsrc</u></i>
table that will automatically create the sequence for a corpus when a
new corpus is added by inserting a new row in table <i><u>kwsrc</u></i>.
 The sequence will be created with minimum, maximum and increment
values corresponding to the <i><span style="text-decoration: none"><span style="background: transparent">.smin</span></span></i>,
<i><span style="text-decoration: none"><span style="background: transparent">.smax</span></span></i>
and <i><span style="text-decoration: none"><span style="background: transparent">.sincr</span></span></i>
values in the new <i><u>kwsrc</u></i> row,  Note that these values
are only used when creating the sequence (which in turn happens only
when a new row is inserted in <i><u>kwsrc</u></i>); changes made to
these values after the sequence was created will have no effect.  The
sequence will be named “seq_” followed by the string given in
<i><span style="text-decoration: none"><span style="background: transparent">kwsrc.seq</span></span></i>
something.  When a  <i><u>kwsrc</u></i> row is deleted the trigger
will automatically delete the associated sequence.  
</p>
<ol>
	<ol start="8">
		<li/>
<h2 class="western">XML Round-tripping</h2>
	</ol>
</ol>
<p style="margin-bottom: 0.2in">The module “fmtxml.py” will
generate XML from an entry object read from the database.  There may
be differences between this regenerated XML and the original JMdict
file XML that produced the database entry.  The following are things
I am aware of that may differ:</p>
<ul>
	<li/>
<p style="margin-bottom: 0.2in">Comments in the XML are not
	preserved so cannot be regenerated.<a class="sdfootnoteanc" name="sdfootnote3anc" href="#sdfootnote3sym"><sup>3</sup></a></p>
	<li/>
<p style="margin-bottom: 0.2in">Element order may vary.
	Although elements are generated in the order defined by the JMdict
	DTD, when there are multiple successive elements of the same type,
	order may not be the same as in the original XML in some cases.  The
	following elements will retain the original order: k_ele, r_ele,
	sense, gloss, k_inf, r_inf, pos, misc, field, dial, lsource, audit. 
	The order of re_restr, stagr, stagk, ke_pri, and re_pri elements may
	differ.   Entry elements in the current JMdict are in seq number
	order and can be regenerated in that order.  Were that order to
	change though, it would not be preserved in the regenerated XML.  
	</p>
	<li/>
<p style="margin-bottom: 0.2in">When a sense without any “pos”
	(part-of-speech) tags follows a sense with pos tags, the pos tags on
	the preceding sense are assigned to the following sense.  Thus
	regenerated XML may have pos tags in senses that didn't have them in
	the source XML.</p>
	<li/>
<p style="margin-bottom: 0.2in">Regenerated XML takes
	advantage of default values when possible.  If the source XML
	redundantly specifies a default value (xml:lang=”eng” for
	example) it will not be reproduced in the regenerated XML.</p>
	<li/>
<p style="margin-bottom: 0.2in">An xref in the database always
	refers to a specific target entry, and a single sense in that entry.
	 An xref in the XML may or may not specify a target entry's sense.
	When the target entry has multiple senses, but the XML fails to give
	any senses, the XML importer will generate multiple xref's, one to
	each target sense. If the XML exporter sees a set of xrefs pointing
	to every sense of a target entry, it will  assume the input XML did
	not specify any senses and generate an &lt;xref&gt; element with no
	sense numbers.  However the source XML may have explicitly listed
	every sense number of the target entry.  This is a particular
	problem when the number of target senses is one.  (That is, xrefs of
	the form &lt;xref&gt;<font face="Andale Sans UI"><span lang="ja-JP">供・とも</span></font>&lt;/xref&gt;
	and &lt;xref&gt;<font face="Andale Sans UI"><span lang="ja-JP">供・とも・</span></font>(1)&lt;/xref&gt;
	will both result in &lt;xref&gt;<font face="Andale Sans UI"><span lang="ja-JP">供・とも</span></font>&lt;/xref&gt;
	when the XML is regenerated, assuming the target entry has only one
	sense.)</p>
	<li/>
<p style="margin-bottom: 0.2in">Duplicate tags are filtered
	out during importing from XML and will not be produced in the
	regenerated XML.  In particular, some JMdict entries have multiple
	&lt;k_pri&gt; or &lt;re_pri&gt; tags.</p>
	<li/>
<p style="margin-bottom: 0.2in">When &lt;ke_pri&gt; or
	&lt;re_pri&gt; conflict, that is, there are two tags with the same
	scale (text value) but different numerical values (e.g. “nf09”
	and “nf14”, or “ichi1” and “ichi2”) that apply to the
	same reading and kanji pair, the one with the lower value is used in
	the database, the one with the higher value is discarded and thus
	won't appear in the regenerated XML.  Note this only applies to freq
	values associated with the same reading, kanji pair: if R1 has
	“nf09”, “nf14”, K1 has “nf09”, and K2 has “nf14”,
	nothing is discarded because the two freq values are associated with
	different pairs (R1,K1, and R1,K2).</p>
	<li/>
<p style="margin-bottom: 0.2in">The database can represent
	information that currently has no means of representation in XML
	with the standard JMdict DTD.  Specifically:</p>
	<li/>
<p class="list-2-start-western">Some tables provide for
	additional information such as <i><span style="text-decoration: none"><span style="background: transparent">notes,
	status, parent </span></span></i>in the <i><u>entr</u></i> table, or
	<i><span style="text-decoration: none"><span style="background: transparent">email,
	refs, notes</span></span></i> in the <i><u>hist</u></i> table (maps
	to the &lt;audit&gt; XML element) that JMdict does not support.</p>
	<li/>
<p class="list-2-start-western">Cross-references refer to a
	specific entry even when there multiple references with the same
	reading or kanji text.</p>
	<li/>
<p class="list-2-start-western">Cross-references may have more
	types that just the “see also” and “antonym” types available
	in the current JMdict XML.</p>
	<li/>
<p class="list-2-start-western">Readings can have sound clips.</p>
	<li/>
<p class="list-2-start-western">There may be keyword values in
	the kw* tables and used in the database that do not have equivalent
	entities defined in the JMdict DTD.</p>
	<p style="margin-bottom: 0.2in">If entries are created that make use
	of these capabilities, the additional information will not be
	representable in a regenerated JMdict XML file.</p>
</ul>
<ol start="2">
	<li/>
<h1 class="western"> An Example Entry</h1>
</ol>
<p style="margin-bottom: 0.2in">This section looks at the actual
table data used to store a JMdict entry, using data extracted from a
live database.</p>
<p style="margin-bottom: 0.2in">Here is entry 1211370 as displayed by
wwwjdic:</p>
<p style="margin-left: 0.5in; text-indent: -0.01in; margin-bottom: 0.2in">
<font face="Andale Sans UI"><span lang="ja-JP">堪能</span></font>(P);
<font face="Andale Sans UI"><span lang="ja-JP">勘能 【たんのう</span></font>(<font face="Andale Sans UI"><span lang="ja-JP">堪能</span></font>)(P);
<font face="Andale Sans UI"><span lang="ja-JP">かんのう</span></font>(ok)<font face="Andale Sans UI"><span lang="ja-JP">】
</span></font>(adj-na) (1) proficient; skillful; (n,vs) (2)
satisfaction; (n,vs) (3) {Buddh} fortitude; (P)</p>
<p style="margin-bottom: 0.2in">And here is its representation in the
JMdictDB database:</p>
<p style="margin-bottom: 0.2in">Table <i><u>entr</u></i> row:</p>
<p style="margin-bottom: 0.2in; background: #e6e6ff; border: 1px solid #000000; padding: 0.02in; page-break-inside: avoid; widows: 0; orphans: 0; page-break-before: auto; page-break-after: avoid">
<font face="Courier New, monospace"><font size="2" style="font-size: 9pt"><kbd>select
* from entr where seq=1211370;<br>id&nbsp;&nbsp;&nbsp;&nbsp;| src |
stat | seq&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| dfrm | unap |
notes<br>------+-----+------+---------+------+------+-------<br>20894
| 1&nbsp;&nbsp;&nbsp;| 2&nbsp;&nbsp;&nbsp;&nbsp;|21211370 | &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|
F&nbsp;&nbsp;&nbsp;&nbsp;|</kbd></font></font></p>
<p style="margin-bottom: 0.2in"><i><span style="text-decoration: none"><span style="background: transparent">id</span></span></i>
is an arbitrary number as assigned when the entry was created.  Its
purpose is to provide an anchor that related rows in other tables can
refer to. Since it may change over time and may be different in
different database instances, it should never be saved externally as
a means of identifying an entry; use <i><span style="text-decoration: none"><span style="background: transparent">seq
</span></span></i>for that.</p>
<p style="margin-bottom: 0.2in"><i><span style="text-decoration: none"><span style="background: transparent">src</span></span></i>
says what collection of entries (“corpus”) this entry belongs to
and refers to table <i><u>kwsrc</u></i>.<i><span style="text-decoration: none"><span style="background: transparent">id</span></span></i>.
<i><span style="text-decoration: none"><span style="background: transparent">id</span></span></i>=1
in <i><u>kwsrc</u></i> says this entry is part of JMdict. Currently
in the EDRDG implementation of JMdictDB all entries are either JMdict
or JMnedict entries but in other database implementations, one could
find other corpora such as the Totoeba “examples” sentences,
Kanjidic2 entries or custom site-specific corpora.</p>
<p style="margin-bottom: 0.2in"><i><span style="text-decoration: none"><span style="background: transparent">stat</span></span></i>
gives that status of this entry. It refers to table <i><u>kwstat</u></i>
and <i><span style="text-decoration: none"><span style="background: transparent">id=</span></span></i>2
in that table is &quot;active&quot;. There are other <i><span style="text-decoration: none"><span style="background: transparent">stat</span></span></i>
values for new, deleted, and rejected entries.</p>
<p style="margin-bottom: 0.2in"><i><span style="text-decoration: none"><span style="background: transparent">seq</span></span></i>
is the same as the &lt;ent_seq&gt; element in JMdict XML file and
identifies each JMdict entry across time and space.</p>
<p style="margin-bottom: 0.2in"><i><span style="text-decoration: none"><span style="background: transparent">dfrm</span></span></i>
and <i><span style="text-decoration: none"><span style="background: transparent">unap</span></span></i>
are used for managing edits and new submissions.</p>
<p style="margin-bottom: 0.2in"><i><span style="text-decoration: none"><span style="background: transparent">notes</span></span></i>
is a text field that can contain arbitrary information pertaining to
an entry that is intended to be displayed to users.</p>
<p style="margin-bottom: 0.2in">Table <i><u>rdng</u></i> rows</p>
<p style="margin-bottom: 0.2in; background: #e6e6ff; border: 1px solid #000000; padding: 0.02in; page-break-inside: avoid; widows: 0; orphans: 0; page-break-before: auto; page-break-after: avoid">
<font face="Courier New, monospace"><font size="2" style="font-size: 9pt">select
* from rdng where entr=20894;<br>entr<kbd>&nbsp;&nbsp;</kbd>| rdng |
txt<br>------+------+----------<br>20894 | 1<kbd>&nbsp;&nbsp;&nbsp;&nbsp;</kbd>|
</font></font><font face="Courier New, monospace"><font size="2" style="font-size: 9pt"><span lang="ja-JP">たんのう</span></font></font><font face="Courier New, monospace"><font size="2" style="font-size: 9pt"><br>20894
| 2<kbd>&nbsp;&nbsp;&nbsp;&nbsp;</kbd>| </font></font><font face="Courier New, monospace"><font size="2" style="font-size: 9pt"><span lang="ja-JP">かんのう</span></font></font></p>
<p style="margin-bottom: 0.2in"><i><span style="text-decoration: none"><span style="background: transparent">entr</span></span></i>
identifies the entry the row belongs to. <i><span style="text-decoration: none"><span style="background: transparent">rdng</span></span></i>
disambiguates and orders multiple readings belonging to the same
entry.  <i><span style="text-decoration: none"><span style="background: transparent">entr</span></span></i>
and <i><span style="text-decoration: none"><span style="background: transparent">rdng
</span></span></i>together constitute the primary key and any other
tables that refers to specific readings (such as <i><u>restr</u></i>
will contain a foreign key to these two columns.  <i><span style="text-decoration: none"><span style="background: transparent">txt</span></span></i>
is the reading text. It is expected to have at least one kana
character and should not contain any kanji characters.</p>
<p style="margin-bottom: 0.2in">Table <i><u>kanj</u></i> rows</p>
<p style="margin-bottom: 0.2in; background: #e6e6ff; border: 1px solid #000000; padding: 0.02in; page-break-inside: avoid; widows: 0; orphans: 0; page-break-before: auto; page-break-after: avoid">
<font face="Courier New, monospace"><font size="2" style="font-size: 9pt">select
* from kanj where entr=20894;<br>entr<kbd>&nbsp;&nbsp;</kbd>| kanj |
txt<br>------+------+------<br>20894 | 1<kbd>&nbsp;&nbsp;&nbsp;&nbsp;</kbd>|
</font></font><font face="Courier New, monospace"><font size="2" style="font-size: 9pt"><span lang="ja-JP">堪能</span></font></font><font face="Courier New, monospace"><font size="2" style="font-size: 9pt"><br>20894
| 2<kbd>&nbsp;&nbsp;&nbsp;&nbsp;</kbd>| </font></font><font face="Courier New, monospace"><font size="2" style="font-size: 9pt"><span lang="ja-JP">勘能</span></font></font></p>
<p style="margin-bottom: 0.2in">This is structured like table <i><u>rdng</u></i>.
Kanji text is expected to contain at least one kanji character.</p>
<p style="margin-bottom: 0.2in">Table <i><u>sens</u></i> rows</p>
<p style="margin-bottom: 0.2in; background: #e6e6ff; border: 1px solid #000000; padding: 0.02in; page-break-inside: avoid; widows: 0; orphans: 0; page-break-before: auto; page-break-after: avoid">
<font face="Courier New, monospace"><font size="2" style="font-size: 9pt">select
* from sens where entr=20894;<br>entr<kbd>&nbsp;&nbsp;</kbd>| sens |
notes<br>------+------+-------<br>20894 | 1<kbd>&nbsp;&nbsp;&nbsp;&nbsp;</kbd>|<br>20894
| 2<kbd>&nbsp;&nbsp;&nbsp;&nbsp;</kbd>|<br>20894 | 3<kbd>&nbsp;&nbsp;&nbsp;&nbsp;</kbd>|</font></font></p>
<p style="margin-bottom: 0.2in">There is a <i><u>sens</u></i> row for
each sense in the entry. <i><span style="text-decoration: none"><span style="background: transparent">entr</span></span></i>
says which entry the sense belongs to, <i><span style="text-decoration: none"><span style="background: transparent">sens</span></span></i>
disambiguates and orders the senses. <i><span style="text-decoration: none"><span style="background: transparent">entr</span></span></i>
and <i><span style="text-decoration: none"><span style="background: transparent">sens</span></span></i>
together constitute the primary key. <i><span style="text-decoration: none"><span style="background: transparent">notes
</span></span></i>contains an optional text providing some
information unique to this sense that is intended to be displayed to
users.</p>
<p style="margin-bottom: 0.2in">Table <i><u>gloss</u></i> rows</p>
<p style="margin-bottom: 0.2in; background: #e6e6ff; border: 1px solid #000000; padding: 0.02in; page-break-inside: avoid; widows: 0; orphans: 0; page-break-before: auto; page-break-after: avoid">
<font face="Courier New, monospace"><font size="2" style="font-size: 9pt">select
* from gloss where entr=20894;<br>entr<kbd>&nbsp;&nbsp;</kbd>| sens |
gloss | lang |
txt<kbd>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</kbd><br>------+------+-------+------+--------------<br>20894
| 1<kbd>&nbsp;&nbsp;&nbsp;&nbsp;</kbd>| 1<kbd>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</kbd>|
1<kbd>&nbsp;&nbsp;&nbsp;&nbsp;</kbd>| proficient<kbd>&nbsp;&nbsp;&nbsp;</kbd><br>20894
| 1<kbd>&nbsp;&nbsp;&nbsp;&nbsp;</kbd>| 2<kbd>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</kbd>|
1<kbd>&nbsp;&nbsp;&nbsp;&nbsp;</kbd>| skillful<kbd>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</kbd><br>20894
| 2<kbd>&nbsp;&nbsp;&nbsp;&nbsp;</kbd>| 1<kbd>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</kbd>|
1<kbd>&nbsp;&nbsp;&nbsp;&nbsp;</kbd>| satisfaction <br>20894 | 3<kbd>&nbsp;&nbsp;&nbsp;&nbsp;</kbd>|
1<kbd>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</kbd>| 1<kbd>&nbsp;&nbsp;&nbsp;&nbsp;</kbd>|
fortitude<kbd>&nbsp;&nbsp;&nbsp;&nbsp;</kbd></font></font></p>
<p style="margin-bottom: 0.2in">In this table we see the first two
rows are glosses for the first sense, the second row is a gloss for
second sense, and the third row a gloss for the third sense.  The
<i><span style="text-decoration: none"><span style="background: transparent">lang</span></span></i>
values are all 1, indicating english (from table <i><u>kwlang</u></i>).
 Because this database instance was loaded from a JMdict_e file,
there are no non-english glosses in it.  Had it been loaded from the
full JMdict file, that would not be the case.</p>
<p style="margin-bottom: 0.2in">Table <i><u>pos</u></i> rows</p>
<p style="margin-bottom: 0.2in; background: #e6e6ff; border: 1px solid #000000; padding: 0.02in; page-break-inside: avoid; widows: 0; orphans: 0; page-break-before: auto; page-break-after: avoid">
<font face="Courier New, monospace"><font size="2" style="font-size: 9pt">select
* from pos where entr=20894;<br>entr<kbd>&nbsp;&nbsp;</kbd>| sens |
ord | kw<br>------+------+-----+----<br>20894 | 1<kbd>&nbsp;&nbsp;&nbsp;&nbsp;</kbd>|
1<kbd>&nbsp;&nbsp;&nbsp;|</kbd> 2<br>20894 | 2<kbd>&nbsp;&nbsp;&nbsp;&nbsp;</kbd>|
2<kbd>&nbsp;&nbsp;&nbsp;| </kbd>17<br>20894 | 2<kbd>&nbsp;&nbsp;&nbsp;&nbsp;</kbd>|
3<kbd>&nbsp;&nbsp;&nbsp;|</kbd> 46<br>20894 | 3<kbd>&nbsp;&nbsp;&nbsp;&nbsp;</kbd>|
4<kbd>&nbsp;&nbsp;&nbsp;|</kbd> 17<br>20894 | 3<kbd>&nbsp;&nbsp;&nbsp;&nbsp;</kbd>|
5<kbd>&nbsp;&nbsp;&nbsp;|</kbd> 46</font></font></p>
<p style="margin-bottom: 0.2in">The <i><u>pos</u></i> table contains
a list of part-of-speech keywords for each sense of an entry.  Again,
<i><span style="text-decoration: none"><span style="background: transparent">entr</span></span></i>
identifies the entry and <i><span style="text-decoration: none"><span style="background: transparent">sens</span></span></i>
the sense.  <i><span style="text-decoration: none"><span style="background: transparent">kw</span></span></i>
refers to the <i><span style="text-decoration: none"><span style="background: transparent">id</span></span></i>
column of table <i><u>kwpos</u></i>. Looking in that table we see the
2 is &quot;adj-na&quot;, 17 is &quot;n&quot;, and 46 is &quot;vs&quot;:</p>
<p style="margin-bottom: 0.2in; background: #e6e6ff; border: 1px solid #000000; padding: 0.02in; page-break-inside: avoid; widows: 0; orphans: 0; page-break-before: auto; page-break-after: avoid">
<font face="Courier New, monospace"><font size="2" style="font-size: 9pt">select
* from kwpos where id in (2,17,46);<br>id
|<kbd>&nbsp;&nbsp;&nbsp;</kbd>kw<kbd>&nbsp;&nbsp;&nbsp;</kbd>|<kbd>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</kbd>descr<br>---+--------+---------------------------------------------------<br><kbd>&nbsp;</kbd>2
| adj-na | adjectival nouns or quasi-adjectives (keiyodoshi)<br>17 |
n<kbd>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</kbd>| noun (common)
(futsuumeishi)<br>46 | vs<kbd>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</kbd>|
noun or participle which takes the aux. verb suru</font></font></p>
<p style="margin-bottom: 0.2in">Table <i><u>fld</u></i> rows</p>
<p style="margin-bottom: 0.2in; background: #e6e6ff; border: 1px solid #000000; padding: 0.02in; page-break-inside: avoid; widows: 0; orphans: 0; page-break-before: auto; page-break-after: avoid">
<font face="Courier New, monospace"><font size="2" style="font-size: 9pt">select
* from fld where entr=20894;<br>entr<kbd>&nbsp;&nbsp;</kbd>| sens |
ord | kw<br>------+------+-----+----<br>20894 | 3<kbd>&nbsp;&nbsp;&nbsp;&nbsp;</kbd>|
1<kbd>&nbsp;&nbsp;&nbsp;|</kbd> 1</font></font></p>
<p style="margin-bottom: 0.2in"><i><u>fld</u></i> is a keyword list
table like <i><u>pos</u></i>: <i><span style="text-decoration: none"><span style="background: transparent">entr
</span></span></i>identifies the entry and <i><span style="text-decoration: none"><span style="background: transparent">sens</span></span></i>
the sense. <i><span style="text-decoration: none"><span style="background: transparent">kw</span></span></i>
refers to the <i><span style="text-decoration: none"><span style="background: transparent">id</span></span></i>
column of table <i><u>kwfld</u></i>.  Looking in that table we see
the 1 is &quot;Buddh&quot;.</p>
<p style="margin-bottom: 0.2in">Table <i><u>rinf</u></i> rows</p>
<p style="margin-bottom: 0.2in; background: #e6e6ff; border: 1px solid #000000; padding: 0.02in; page-break-inside: avoid; widows: 0; orphans: 0; page-break-before: auto; page-break-after: avoid">
<font face="Courier New, monospace"><font size="2" style="font-size: 9pt">select
* from rinf where entr=20894;<br>entr<kbd>&nbsp;&nbsp;</kbd>| rdng |
ord | kw<br>------+------+-----+----<br>20894 | 2<kbd>&nbsp;&nbsp;&nbsp;&nbsp;</kbd>|
1<kbd>&nbsp;&nbsp;&nbsp;| </kbd>3</font></font></p>
<p style="margin-bottom: 0.2in">The <i><u>rinf</u></i> table contains
a list of &lt;re_inf&gt; keywords for each reading of an entry.  <i><span style="text-decoration: none"><span style="background: transparent">entr</span></span></i>
identifies the entry and <i><span style="text-decoration: none"><span style="background: transparent">rdng</span></span></i>
the reading.  <i><span style="text-decoration: none"><span style="background: transparent">kw</span></span></i>
refers to the <i><span style="text-decoration: none"><span style="background: transparent">id</span></span></i>
column of table <i><u>kwrinf</u></i>.  In this case, <i><span style="text-decoration: none"><span style="background: transparent">kw</span></span></i>=3
indicates the rinf keyword, &quot;ok&quot; (&quot;out-dated or
obsolete kana usage&quot;).  It applies only to reading 2 (<font face="Andale Sans UI"><span lang="ja-JP">かんのう</span></font>).</p>
<p style="margin-bottom: 0.2in">The entry we are examining here has
no data in the <i><u>kinf</u></i> table, but that table is the same
except its second column is <i><span style="text-decoration: none"><span style="background: transparent">kanj</span></span></i>
rather than <i><span style="text-decoration: none"><span style="background: transparent">rdng</span></span></i>
and the kw column references table <i><u>kwkinf</u></i> rather than
<i><u>kwrinf</u></i>.</p>
<p style="margin-bottom: 0.2in">Table <i><u>restr</u></i> rows</p>
<p style="margin-bottom: 0.2in; background: #e6e6ff; border: 1px solid #000000; padding: 0.02in; page-break-inside: avoid; widows: 0; orphans: 0; page-break-before: auto; page-break-after: avoid">
<font face="Courier New, monospace"><font size="2" style="font-size: 9pt">select
* from restr where entr=20894;<br>entr<kbd>&nbsp;&nbsp;</kbd>| rdng |
kanj<br>------+------+------<br>20894 | 1<kbd>&nbsp;&nbsp;&nbsp;&nbsp;</kbd>|
2</font></font></p>
<p style="margin-bottom: 0.2in">Contains &lt;re_restr&gt; element
info used when not all combinations of reading and kanji are valid.
<i><span style="text-decoration: none"><span style="background: transparent">entr</span></span></i>
identifies the entry, <i><span style="text-decoration: none"><span style="background: transparent">rdng</span></span></i>
and <i><span style="text-decoration: none"><span style="background: transparent">kanj
</span></span></i>identify a reading and kanji pair that are <em>not
valid</em> together. Note that this is the opposite of the JMdict XML
where re_restr elements identify <em>valid</em> pairs.  Since only
the pair <font face="Andale Sans UI"><span lang="ja-JP">たんのう
</span></font>/ <font face="Andale Sans UI"><span lang="ja-JP">勘能
</span></font>is listed as invalid, the combinations  <font face="Andale Sans UI"><span lang="ja-JP">たんのう
</span></font>/ <font face="Andale Sans UI"><span lang="ja-JP">堪能</span></font>,
 <font face="Andale Sans UI"><span lang="ja-JP">かんのう </span></font>/
 <font face="Andale Sans UI"><span lang="ja-JP">堪能</span></font>,
 and  <font face="Andale Sans UI"><span lang="ja-JP">かんのう </span></font>/
 <font face="Andale Sans UI"><span lang="ja-JP">勘能 </span></font>are
valid.</p>
<p style="margin-bottom: 0.2in">There is no special indicator for the
&quot;re_nokanji&quot; tag that exists in JMdict XML -- simply having
<i><u>restr</u></i> rows for every kanji in an entry paired with one
of the readings in sufficient to indicate that reading is &quot;nokanji&quot;.</p>
<p style="margin-bottom: 0.2in">It is the application 's
responsibility to generate “valid” restr pairs or the “nokanji”
flag from the existing data if that is how the information is to be
presented.</p>
<p style="margin-bottom: 0.2in">Table <i><u>freq</u></i> rows</p>
<p style="margin-bottom: 0.2in; background: #e6e6ff; border: 1px solid #000000; padding: 0.02in; page-break-inside: avoid; widows: 0; orphans: 0; page-break-before: auto; page-break-after: avoid">
<font face="Courier New, monospace"><font size="2" style="font-size: 9pt">select
* from freq where entr=20894;<br>entr<kbd>&nbsp;&nbsp;</kbd>| rdng |
kanj | kw | value<br>------+------+------+----+-------<br>20894 |
1<kbd>&nbsp;&nbsp;&nbsp;&nbsp;</kbd>| 1<kbd>&nbsp;&nbsp;&nbsp;&nbsp;</kbd>|
5<kbd>&nbsp;&nbsp;</kbd>| 16<br>20894 | 1<kbd>&nbsp;&nbsp;&nbsp;&nbsp;</kbd>|
1<kbd>&nbsp;&nbsp;&nbsp;&nbsp;</kbd>| 7<kbd>&nbsp;&nbsp;</kbd>| 1</font></font></p>
<p style="margin-bottom: 0.2in">Table freq contains frequency-of-use
information found in JMdict in the re_pri and ke_pri elements.   As
mentioned earlier, a frequency of use datum usually applies to a
reading-kanji pair, but if not, one of the columns <i><span style="text-decoration: none"><span style="background: transparent">rdng</span></span></i>
or <i><span style="text-decoration: none"><span style="background: transparent">kanj</span></span></i>
may be NULL.   This will be the case for entries without kanji text,
and of frequency metric derived from purely lexicographic means such
as from Internet search engine page counts.  The <i><span style="text-decoration: none"><span style="background: transparent">kw</span></span></i>
column refers to the table <i><u>kwfreq:</u></i></p>
<p style="margin-bottom: 0.2in; background: #e6e6ff; border: 1px solid #000000; padding: 0.02in; page-break-inside: avoid; widows: 0; orphans: 0; page-break-before: auto; page-break-after: avoid">
<font face="Courier New, monospace"><font size="2" style="font-size: 9pt">jmdict=#
select * from kwfreq where id in (5,7);<br> id |&nbsp;&nbsp;kw&nbsp;&nbsp;|
descr<br>----+------+-------<br>&nbsp;&nbsp;5 | nf&nbsp;&nbsp;&nbsp;|<br>&nbsp;&nbsp;7
| news |</font></font></p>
<p style="margin-bottom: 0.2in">So the data shown tells us that the
kanji-1/reading-1 pair (<font face="Andale Sans UI"><span lang="ja-JP">堪能
</span></font>/ <font face="Andale Sans UI"><span lang="ja-JP">たんのう</span></font>)
has the frequency-of-use tags, “nf16” (5,16) and “news1”
(7,1).</p>
<p style="margin-bottom: 0.2in">This entry has no dialect, source
language, misc info, kinf info, etc, so a queries like the following
will return 0 rows:</p>
<p style="margin-bottom: 0.2in; background: #e6e6ff; border: 1px solid #000000; padding: 0.02in; page-break-inside: avoid; widows: 0; orphans: 0; page-break-before: auto; page-break-after: avoid">
<font face="Courier New, monospace"><font size="2" style="font-size: 9pt">select
* from dial where entr=20894;<br>entr | sens | ord |
kw<br>-----+------+-----+----<br>(0 rows)</font></font></p>
<ol start="3">
	<li/>
<h1 class="western">Using SQL</h1>
</ol>
<p style="margin-bottom: 0.2in">This section describes how the table
structures and relations previously discussed affect the SQL you
write to find and extract data.</p>
<ol>
	<ol>
		<li/>
<h2 class="western">Retrieving an Entry's Data</h2>
	</ol>
</ol>
<p style="margin-bottom: 0.2in">If you are writing SQL as part of an
application, extraction of data is easy in most cases.  That is
because there is a library API that you can use that will extract all
the data needed and construct an object representation of the entry
in application code.  In this case the library API will take care of
the SQL for you, if you know the entries you want.  In the JMdictDB
code, the Python library module jdb.py contains function entrList()
which does this.</p>
<p style="margin-bottom: 0.2in">Even if you need to write the SQL
yourself (perhaps because you are creating such an API function) it
is quite simple.  Because all the tables have a column <i><span style="text-decoration: none"><span style="background: transparent">entr</span></span></i>
you need to execute a set of SQL statements, one for each table, with
a WHERE clause that specifies the the <i><span style="text-decoration: none"><span style="background: transparent">entr</span></span></i>
values you are interested in.  For example (in Perl) assuming that
the variables $id1 and $id2 contain the entry id numbers of two
entries you are interested in:</p>
<p style="margin-bottom: 0.2in; background: #e6e6ff; border: 1px solid #000000; padding: 0.02in; page-break-inside: avoid; widows: 0; orphans: 0; page-break-before: auto; page-break-after: avoid">
<font face="Courier New, monospace"><font size="1" style="font-size: 8pt">$dbh
  = DBI-&gt;connect(&quot;dbi:Pg:dbname=”jmdict”, PrintWarn=&gt;0,
RaiseError=&gt;1)<br>$dbh-&gt;{pg_enable_utf8} = 1;<br>$sth   =
$dbh-&gt;execute (“SELECT * FROM entr WHERE id IN (?,?)”,
[$id1,$id2]);<br>$entr  = $sth-&gt;fetchall ();<br>$sth   =
$dbh-&gt;execute (“SELECT * FROM kanj WHERE entr IN (?,?)”,
[$id1,$id2]);<br>$kanj  = $sth-&gt;fetchall ();<br>$sth   =
$dbh-&gt;execute (“SELECT * FROM kinf WHERE entr IN (?,?)”,
[$id1,$id2]);<br>$kinf  = $sth-&gt;fetchall ();<br>$sth   =
$dbh-&gt;execute (“SELECT * FROM kfreq WHERE entr IN (?,?)”,
[$id1,$id2]);<br>$kfreq = $sth-&gt;fetchall ();<br>$sth   =
$dbh-&gt;execute (“SELECT * FROM rdng WHERE entr IN (?,?)”,
[$id1,$id2]);<br>$rdng  = $sth-&gt;fetchall ();<br>$sth   =
$dbh-&gt;execute (“SELECT * FROM sens WHERE entr IN (?,?)”,
[$id1,$id2]);<br>$sens  = $sth-&gt;fetchall ();<br>[...]</font></font></p>
<p style="margin-bottom: 0.2in">or in Python (using the Psycopg2
Postgresql adapter):</p>
<p style="margin-bottom: 0.2in; background: #e6e6ff; border: 1px solid #000000; padding: 0.02in; page-break-inside: avoid; widows: 0; orphans: 0; page-break-before: auto; page-break-after: avoid">
<font face="Courier New, monospace"><font size="1" style="font-size: 8pt">dbh
   = conn = psycopg2.connect
(database=”jmdict”)<br>psycopg2.extensions.register_type(psycopg2.extensions.UNICODE)<br>cursor
= dbh.cursor()<br>cursor.execute (“SELECT * FROM entr WHERE id IN
(?,?)”, [id1,id2])<br>entr   = cursor.fetchall ()<br>cursor.execute
(“SELECT * FROM kanj WHERE entr IN (?,?)”, [id1,id2])<br>kanj  =
cursor.fetchall ()<br>cursor.execute (“SELECT * FROM kinf WHERE
entr IN (?,?)”, [id1,id2])<br>kinf  = cursor.fetchall
()<br>cursor.execute (“SELECT * FROM kfreq WHERE entr IN (?,?)”,
[id1,id2])<br>kfreq = cursor.fetchall ()<br>cursor.execute (“SELECT
* FROM rdng WHERE entr IN (?,?)”, [id1,id2])<br>$dng  =
cursor.fetchall ()<br>cursor.execute (“SELECT * FROM sens WHERE
entr IN (?,?)”, [id1,id2])<br>sens  = cursor.fetchall ()<br>[...]</font></font></p>
<p style="margin-bottom: 0.2in">Having gotten all the needed rows for
the entries $id1 and $id2 in variables $entr, $kanj, etc., you can
now use that data to build the objects representing the two entries.</p>
<ol>
	<ol start="2">
		<li/>
<h2 class="western">Finding Entries</h2>
	</ol>
</ol>
<p style="margin-bottom: 0.2in">When you need to find information,
the SQL becomes more complex.  The basic rule is that you need to
join together those tables that have columns that are part of your
search criteria.  Fortunately, because the relationship hierarchy is
simple and fixed, this too is usually quite straight forward.  Since
you will usually want to know which entries meet the criteria, you
will be interested in getting the <i><span style="text-decoration: none"><span style="background: transparent">entr.id</span></span></i>
values.  In many cases you may not even need a join.</p>
<p style="margin-bottom: 0.2in">For example, to find the entries that
have a reading, “<font face="Andale Sans UI"><span lang="ja-JP">つける”</span></font>,
the following is sufficient:</p>
<p style="margin-bottom: 0.2in; background: #e6e6ff; border: 1px solid #000000; padding: 0.02in; page-break-inside: avoid; widows: 0; orphans: 0; page-break-before: auto; page-break-after: avoid">
<font face="Courier New, monospace"><font size="2" style="font-size: 9pt"><br>SELECT
entr FROM rdng WHERE txt='</font></font><font face="Courier New, monospace"><font size="2" style="font-size: 9pt"><span lang="ja-JP">つける</span></font></font><font face="Courier New, monospace"><font size="2" style="font-size: 9pt">';<br></font></font><br/>
<br/>

</p>
<p style="margin-bottom: 0.2in">Of course, if the criteria include
information that is in different tables, a join or some other
combination of the tables is inevitable.   To find the entries that
contain both “<font face="Andale Sans UI"><span lang="ja-JP">つけ”
</span></font>and “<font face="Andale Sans UI"><span lang="ja-JP">漬”</span></font>,
and have a sense with a PoS that is a noun:</p>
<p style="margin-bottom: 0.2in; background: #e6e6ff; border: 1px solid #000000; padding: 0.02in; page-break-inside: avoid; widows: 0; orphans: 0; page-break-before: auto; page-break-after: avoid">
<font face="Courier New, monospace"><font size="2" style="font-size: 9pt">SELECT
DISTINCT r.entr <br>  FROM rdng r <br>  JOIN kanj k ON k.entr=r.entr
<br>  JOIN pos p ON p.entr=k.entr<br>  WHERE r.txt LIKE '%</font></font><font face="Courier New, monospace"><font size="2" style="font-size: 9pt"><span lang="ja-JP">つけ</span></font></font><font face="Courier New, monospace"><font size="2" style="font-size: 9pt">%'
<br>    AND k.txt LIKE '%</font></font><font face="Courier New, monospace"><font size="2" style="font-size: 9pt"><span lang="ja-JP">漬</span></font></font><font face="Courier New, monospace"><font size="2" style="font-size: 9pt">%'<br>
   AND p.kw = 17;</font></font></p>
<p style="margin-bottom: 0.2in">“17” is the <i><span style="text-decoration: none"><span style="background: transparent">id</span></span></i>
number of the “noun” keyword in table <i><u>kwpos</u></i>.  
</p>
<p style="margin-bottom: 0.2in">If you need more than just the
<i><span style="text-decoration: none"><span style="background: transparent">entr.id</span></span></i>,
say the entry's sequence number, then the <i><u>entr</u></i> table
will also need to be included:</p>
<p style="margin-bottom: 0.2in; background: #e6e6ff; border: 1px solid #000000; padding: 0.02in; page-break-inside: avoid; widows: 0; orphans: 0; page-break-before: auto; page-break-after: avoid">
<font face="Courier New, monospace"><font size="2" style="font-size: 9pt">SELECT
DISTINCT e.seq <br>  FROM entr e<br>  JOIN rdng r ON r.entr=e.id<br> 
JOIN kanj k ON k.entr=r.entr <br>  JOIN pos p ON p.entr=k.entr<br> 
WHERE r.txt LIKE '%</font></font><font face="Courier New, monospace"><font size="2" style="font-size: 9pt"><span lang="ja-JP">つけ</span></font></font><font face="Courier New, monospace"><font size="2" style="font-size: 9pt">%'
<br>    AND k.txt LIKE '%</font></font><font face="Courier New, monospace"><font size="2" style="font-size: 9pt"><span lang="ja-JP">漬</span></font></font><font face="Courier New, monospace"><font size="2" style="font-size: 9pt">%'<br>
   AND p.kw != 17;</font></font></p>
<p style="margin-bottom: 0.2in">It is noteworthy that the <i><u>sens</u></i>
table was not needed in the above two queries, even though it is lies
between <i><u>entr</u></i> and <i><u>pos</u></i> in the table
hierarchy.</p>
<ol>
	<ol start="3">
		<li/>
<h2 class="western">Views</h2>
	</ol>
</ol>
<p>The scripts that build that database include mkviews.sql which
creates a number of useful views and functions, including ones to
provide a (somewhat simplified) edict-ish textual summary of an
entry, list valid and invalid reading-kanji combinations based on
table <i><u>restr</u></i>, present meta-information about entries
such as the number of kanji, readings and senses each has, and
others.  They are currently still in too much flux to document yet,
but will be included in a future version of this paper.  
</p>
<p>In the meantime, the comments in pg/mkviews.sql may be useful. 
</p>
<p style="margin-bottom: 0.2in"><br/>
<br/>

</p>
<ol start="4">
	<li/>
<h1 class="western"> Annotated Schema</h1>
</ol>
<p>The Postgresql DDL statements below will create the tables
described above.  They are based on revision 1.29 (2007/09/09) of
mktables.sql.  As commonly happens, this documentation may lag behind
the code and so should not be taken as definitive.<samp class="western"><br></samp><br/>
<br/>

</p>
<p><samp class="western">CREATE TABLE entr (<br>    id SERIAL NOT
NULL PRIMARY KEY,<br>      -- Arbitrary and unique integer to
identify entries within<br>      -- the database.  We don't want to
use </samp><i><span style="text-decoration: none"><span style="background: transparent">seq</span></span></i><samp class="western">
as the PK because<br>      -- the database may include entries from
non-JMdict sources<br>      -- (such as JMnedict) in the future and
those source may not<br>      -- have seq numbers.<br>      -- All
rows in other tables related to an entry will have a <br>      --
foreign key pointing to the entry's </samp><i><span style="text-decoration: none"><span style="background: transparent">id</span></span></i><samp class="western">
value.<br>    src SMALLINT NOT NULL,<br>      -- Indicates where this
entry came from (1=jmdict).  <br>      -- References </samp><i><u>kwsrc</u></i><samp class="western">.<br>
   stat SMALLINT NOT NULL,<br>      -- References table </samp><i><u>kwstat</u></i><samp class="western">
and indicates the status of this<br>      -- entry.  Typical values
are &quot;new”, “active”, “deleted”, <br>      --
&quot;rejected”, etc.<br>    seq INT NOT NULL,<br>      -- Sequence
number.  This number maps to the &lt;ent_seq&gt;<br>      -- element
of the JMdict XML file, and is intended<br>      -- to be a stable
identifier of a particular word.  (The <br>      -- </samp><i><span style="text-decoration: none"><span style="background: transparent">id</span></span></i><samp class="western">
column is *not* suitable for uses spanning either<br>      -- time or
space.)<br>    dfrm INT,<br>      -- References another entry that
was the edit source for <br>      -- this entry.<br>    unap BOOLEAN
NOT NULL,<br>      -- If TRUE, this entry has not been approved by an
editor.<br>    srcnote VARCHAR(255),<br>      -- Additional ad-hoc
information about the source of this<br>      -- entry.<br>    notes
TEXT<br>      -- Arbitrary textual information about this entry. 
Will be<br>      -- displayed by applications.<br>     );<br><br>CREATE
SEQUENCE seq <br>      -- This is a sequence for getting new </samp><i><span style="text-decoration: none"><span style="background: transparent">entr.seq</span></span></i><samp class="western">
values.  It is<br>      -- not </samp><i><span style="text-decoration: none"><span style="background: transparent">entr.seq</span></span></i><samp class="western">'s
default value and applications are expected<br>      -- to get new
seq values and apply them when needed.<br>      -- MAXVALUE is
&lt;9000000 in order not to intrude of the space <br>      --
reserved for the jis212 entries.<br>    INCREMENT 10 MINVALUE 1000000
MAXVALUE 8999999 <br>      NO CYCLE OWNED BY entr.seq;<br><br>CREATE
TABLE rdng (<br>      -- Defines the reading (or other kana
representation)<br>      -- of an entry.  All entries are expected to
have at <br>      -- least one reading row.  Maps to the JMdict XML
element<br>      -- &lt;re_ele&gt;.<br>    entr INT NOT NULL,<br>    
 -- FK to entr.id to identify the entry that this reading <br>     
-- belongs to.<br>    rdng SMALLINT NOT NULL,<br>      --
Disambiguates and orders multiple readings in an entry.<br>    txt
VARCHAR(2048) NOT NULL,<br>      -- The reading text.  Should contain
at least one kana <br>      -- character and should not contain any
kanji characters.<br>      -- Maps to the JMdict XML element &lt;reb&gt;.<br>
   PRIMARY KEY(entr,rdng));<br><br>CREATE TABLE kanj (<br>      --
Defines a kanji text associated with an entry.  An entries<br>     
-- may not have any kanji rows.  Maps to the JMdict XML element<br>  
   -- &lt;ke_ele&gt;.<br>    entr INT NOT NULL,<br>      -- FK to
</samp><i><span style="text-decoration: none"><span style="background: transparent">entr.id</span></span></i><samp class="western">
to identify the entry that this kanji <br>      -- string belongs
to.<br>    kanj SMALLINT NOT NULL,<br>      -- Disambiguates and
orders multiple kanji in an entry.<br>    txt VARCHAR(2048) NOT
NULL,<br>      -- The kanji text.  Should contain at least one kani <br>
     -- character.  Maps to the JMdict XML element &lt;keb&gt;.<br>  
 PRIMARY KEY(entr,kanj));</samp></p>
<p><samp class="western"><br>CREATE TABLE sens (<br>      --
Represents an individual sense in an entry.  Maps to the <br>      --
the JMdict XML element &lt;sense&gt;.<br>    entr INT NOT NULL,<br>  
   -- FK to entr.id to identify the entry that this sense <br>     
-- belongs to.<br>    sens SMALLINT NOT NULL,<br>      --
Disambiguates and orders multiple senses in an entry.<br>    notes
TEXT,<br>      -- Arbitrary additional textual information pertaining
to <br>      -- this sense.  Maps to the JMdict XML &lt;s_inf&gt;
element.<br>    PRIMARY KEY(entr,sens));<br><br>CREATE TABLE gloss (<br>
     -- Represents a gloss in a sense.  Maps to the JMdict XML<br>   
  -- &lt;gloss&gt; element.<br>    entr INT NOT NULL,<br>      -- FK
to </samp><i><span style="text-decoration: none"><span style="background: transparent">entr.id</span></span></i><samp class="western">
to identify the entry this gloss belongs to.<br>    sens SMALLINT NOT
NULL,<br>      -- FK to </samp><i><span style="text-decoration: none"><span style="background: transparent">sens.sens</span></span></i><samp class="western">
to identify the sense this gloss belongs to.<br>    gloss SMALLINT
NOT NULL,<br>      -- Disambiguates and orders multiple glosses in a
sense.<br>    lang SMALLINT NOT NULL,<br>      -- FK to </samp><i><u>kwlang</u></i><i><span style="text-decoration: none"><span style="background: transparent">.id</span></span></i><samp class="western">.
 Language of this gloss.<br>    ginf SMALLINT NOT NULL,<br>      --
FK to </samp><i><u>kwginf</u></i><samp class="western">.</samp><i><span style="text-decoration: none"><span style="background: transparent">id</span></span></i><samp class="western">.
 Type of gloss.<br>    txt VARCHAR(2048) NOT NULL,<br>      -- The
gloss text.<br>    PRIMARY KEY(entr,sens,gloss));<br><br>CREATE TABLE
xref (<br>      -- Models various types of cross-references between
entries (or<br>      -- more accurately, between senses of entries.) 
Maps approximately<br>      -- to JMdict XML elements &lt;xref&gt;
and &lt;ant&gt;.<br>    entr INT NOT NULL,<br>      -- FK to </samp><i><span style="text-decoration: none"><span style="background: transparent">entr.id</span></span></i><samp class="western">.
 Identifies the entry this cross-reference<br>      -- belongs to.<br>
   sens SMALLINT NOT NULL,<br>      -- FK to </samp><i><span style="text-decoration: none"><span style="background: transparent">sens.id</span></span></i><samp class="western">.
 Identifies the sense this cross-reference<br>      -- belongs to.<br>
   xref SMALLINT NOT NULL,<br>      -- Disambiguates and orders
multiple xrefs in a sense.<br>    typ SMALLINT NOT NULL,<br>      --
FK to </samp><i><span style="text-decoration: none"><span style="background: transparent">kwxref.id</span></span></i><samp class="western">.
 Identifies the type of cross reference.<br>    xentr INT NOT NULL,<br>
     -- FK to </samp><i><span style="text-decoration: none"><span style="background: transparent">entr.id</span></span></i><samp class="western">.
 Identifies the entry this cross-reference<br>      -- points to.<br>
   xsens SMALLINT NOT NULL,<br>      -- FK to </samp><i><span style="text-decoration: none"><span style="background: transparent">sens.id</span></span></i><samp class="western">.
 Identifies the sense this cross-reference<br>      -- points to.<br>
   rdng SMALLINT,<br>      -- FK to </samp><i><span style="text-decoration: none"><span style="background: transparent">rdng.rdng</span></span></i><samp class="western">.
 Identifies the reading to use when displaying<br>         this
cross-reference.<br>    kanj SMALLINT,<br>      -- FK to </samp><i><span style="text-decoration: none"><span style="background: transparent">kanj.kanj</span></span></i><samp class="western">.
 Identifies the kanji to use when displaying<br>         this
cross-reference.<br>    notes TEXT,<br>      -- Additional textual
information pertaining to this cross-<br>      -- reference for
display to user.<br>    PRIMARY KEY (entr,sens,xref));</samp></p>
<p><samp class="western"><br>CREATE TABLE hist (<br>      -- This
table maintains a series of history records for each<br>      --
entry that documents significant changes to the entry.<br>      --
Maps roughly to JMdict element &lt;audit&gt;.<br>    entr INT NOT
NULL,<br>      -- FK to </samp><i><span style="text-decoration: none"><span style="background: transparent">entr.id</span></span></i><samp class="western">.
 Identifies the entry this history record<br>      -- belongs to.<br>
   hist SMALLINT NOT NULL,<br>      -- Disambiguates and orders
multiple hist records with an entry.<br>    stat SMALLINT NOT NULL,<br>
     -- FK to </samp><i><span style="text-decoration: none"><span style="background: transparent">kwstat.id</span></span></i><samp class="western">.
 Status of entry after the change this<br>      -- record documents
was made.<br>    unap BOOLEAN NOT NULL DEFAULT TRUE,<br>      --
Approval status of entry after this change was made.<br>    dt
TIMESTAMP NOT NULL DEFAULT NOW(),<br>      -- Date and time changes
were made.<br>    userid VARCHAR(20),<br>      -- If user making
change was a logged in editor, this is that <br>      -- editor's
authenticated userid.<br>    name VARCHAR(250),<br>      --
Unauthenticated name of user who made the changes.<br>    email
VARCHAR(250),<br>      -- Unauthenticated email address of user who
made the changes.<br>    diff TEXT,<br>      -- Text string that
documents the difference between the original<br>      -- and changed
entries.<br>    Refs TEXT,<br>      -- Verifiable public references
supporting this change.<br>    notes TEXT<br>      -- Additional
textual information pertaining to this change.<br>      );<br><br>CREATE
TABLE xresolv (<br>      -- This table is used only during loading
the database from<br>      -- a JMdict XML file.  It holds xref
strings prior to resoling<br>      -- them to actual entry/senses.<br>
   entr INT NOT NULL, <br>    sens SMALLINT NOT NULL, <br>    ord
SMALLINT NOT NULL,<br>    typ SMALLINT NOT NULL, <br>    rtxt
VARCHAR(250),<br>    ktxt VARCHAR(250),<br>    tsens SMALLINT, <br>  
 notes VARCHAR(250),<br>    prio BOOLEAN DEFAULT FALSE, <br><br>CREATE
TABLE freq (<br>      -- Contains frequency-of-use items from the
JMdict XML &lt;ke_pri&gt;<br>      -- &lt;re_pri&gt; elements, and
other sources.<br>    entr INT NOT NULL,<br>      -- FK to </samp><i><span style="text-decoration: none"><span style="background: transparent">entr.id</span></span></i><samp class="western">.
 Identifies the entry this datum is associated<br>      -- with.<br> 
  rdng SMALLINT NULL,<br>      -- FK to </samp><i><span style="text-decoration: none"><span style="background: transparent">rdng.rdng</span></span></i><samp class="western">.
 Identifies the reading item that this datum<br>      -- applies to. 
May be NULL if it applies to only a kanji element.<br>    kanj
SMALLINT NULL,<br>      -- FK to </samp><i><span style="text-decoration: none"><span style="background: transparent">kanj.kanj</span></span></i><samp class="western">.
 Identifies the kanji item that this datum<br>      -- applies to. 
May be NULL if it applies to only a reading element.<br>    kw
SMALLINT NOT NULL,<br>      -- FK to </samp><i><span style="text-decoration: none"><span style="background: transparent">kwfreq.id</span></span></i><samp class="western">.
 Identifies the FoU scale in table </samp><i><u>kwfreq</u></i><samp class="western">.<br>
   value INT,<br>      -- The value of the datum on the scale
identified by </samp><i><span style="text-decoration: none"><span style="background: transparent">kw</span></span></i><samp class="western">.<br>
   UNIQUE (entr,rdng,kanj,kw),<br>    CHECK (rdng NOTNULL OR kanj
NOTNULL));<br><br>CREATE TABLE dial (<br>      -- Provides lists of
dialects for senses.  This information<br>      -- corresponds to the
JMdict XML &lt;dial&gt; element.<br>    entr INT NOT NULL,<br>     
-- FK to </samp><i><span style="text-decoration: none"><span style="background: transparent">entr.id</span></span></i><samp class="western">.
 Identifies entry that dialect applies to.<br>    sens SMALLINT NOT
NULL,<br>      -- FK to </samp><i><span style="text-decoration: none"><span style="background: transparent">sens.sens</span></span></i><samp class="western">.
 Identifies the sense that field applies to.<br>    ord SMALLINT NOT
NULL,<br>      -- Maintains order of keywords.<br>    kw SMALLINT NOT
NULL,<br>      -- FK to </samp><i><span style="text-decoration: none"><span style="background: transparent">kwdial.id</span></span></i><samp class="western">.
 Identifies the dialect keyword.<br>    PRIMARY KEY
(entr,sens,kw));<br><br>CREATE TABLE fld (<br>      -- Provides lists
of fields for entries.  This information<br>      -- corresponds to
the JMdict XML &lt;field&gt; element.<br>    entr INT NOT NULL,<br>  
   -- FK to </samp><i><span style="text-decoration: none"><span style="background: transparent">entr.id</span></span></i><samp class="western">.
 Identifies entry that field applies to.<br>    sens SMALLINT NOT
NULL,<br>      -- FK to </samp><i><span style="text-decoration: none"><span style="background: transparent">sens.sens</span></span></i><samp class="western">.
 Identifies the sense that field applies to.<br>    ord SMALLINT NOT
NULL,<br>      -- Maintains order of keywords.<br>    kw SMALLINT NOT
NULL,<br>      -- FK to </samp><i><span style="text-decoration: none"><span style="background: transparent">kwfld.id</span></span></i><samp class="western">.
 Identifies the field keyword.<br>    PRIMARY KEY
(entr,sens,kw));<br><br>CREATE TABLE kinf (<br>      -- Provides
lists of kanji info tags for kanji items.  This<br>      --
information corresponds to the JMdict XML &lt;ke_inf&gt; element.<br>
   entr INT NOT NULL,<br>      -- FK to </samp><i><span style="text-decoration: none"><span style="background: transparent">entr.id</span></span></i><samp class="western">.
 Identifies entry that the kinf tag applies to.<br>    kanj SMALLINT
NOT NULL,<br>      -- FK to </samp><i><span style="text-decoration: none"><span style="background: transparent">kanj.kanj</span></span></i><samp class="western">.
 Identifies the kanji item that kinf tag<br>      -- applies to.<br> 
  ord SMALLINT NOT NULL,<br>      -- Maintains order of keywords.<br>
   kw SMALLINT NOT NULL,<br>      -- FK to </samp><i><span style="text-decoration: none"><span style="background: transparent">kwkinf.id</span></span></i><samp class="western">.
 Identifies the kanji info keyword.<br>    PRIMARY KEY
(entr,kanj,kw));<br><br>CREATE TABLE lsrc (<br>      -- Provides the
foreign language word and language for each<br>      -- sense for
imported words.  This information corresponds to<br>      -- the
JMdict XML &lt;lsource&gt; element.<br>    entr INT NOT NULL,<br>    
 -- FK to </samp><i><span style="text-decoration: none"><span style="background: transparent">entr.id</span></span></i><samp class="western">.
 Identifies entry that field applies to.<br>    sens SMALLINT NOT
NULL,<br>      -- FK to </samp><i><span style="text-decoration: none"><span style="background: transparent">enrt.sens</span></span></i><samp class="western">.
 Identifies the sens item that lsrc tag<br>      -- applies to.<br>  
 ord SMALLINT NOT NULL,<br>      -- Maintains order of keywords.<br> 
  lang SMALLINT NOT NULL,<br>      -- FK to </samp><i><span style="text-decoration: none"><span style="background: transparent">kwlang.id</span></span></i><samp class="western">.
 Identifies the language keyword.<br>    txt VARCHAR(250)<br>      --
The word in language 'lang' from which this word sense <br>      --
was derived.<br>    part BOOLEAN,<br>      -- When FALSE, indicates
the entire Japanese word/sense was<br>      -- derived from this
source word.  When TRUE, only a part of<br>      -- the Japanese word
was derived from the source word.<br>    wasei BOOLEAN,<br>      --
When FALSE, this source word or phrase is a valid word<br>      -- or
phrase with currency in its language.  When TRUE, this<br>      --
source word does not have currency in its language. <br>    PRIMARY
KEY (entr,sens,kw,txt));<br><br>CREATE TABLE misc (<br>      --
Provides lists of misc tags for senses.  This information<br>      --
corresponds to the JMdict XML &lt;misc&gt; element.<br>    entr INT
NOT NULL,<br>      -- FK to </samp><i><span style="text-decoration: none"><span style="background: transparent">entr.id</span></span></i><samp class="western">.
 Identifies entry that misc tag applies to.<br>    sens SMALLINT NOT
NULL,<br>      -- FK to </samp><i><span style="text-decoration: none"><span style="background: transparent">sens.sens</span></span></i><samp class="western">.
 Identifies the sense that misc tag applies to.<br>    ord SMALLINT
NOT NULL,<br>      -- Maintains order of keywords.<br>    kw SMALLINT
NOT NULL,<br>     -- FK to </samp><i><span style="text-decoration: none"><span style="background: transparent">kwmisc.id</span></span></i><samp class="western">.
 Identifies the misc keyword.<br>    PRIMARY KEY
(entr,sens,kw));<br><br>CREATE TABLE pos (<br>      -- Provides lists
of pos (part-of-speech) tags for senses.  <br>      -- This
information corresponds to the JMdict XML &lt;pos&gt; element.<br>   
entr INT NOT NULL,<br>      -- FK to </samp><i><span style="text-decoration: none"><span style="background: transparent">entr.id</span></span></i><samp class="western">.
 Identifies entry that pos tag applies to.<br>    sens SMALLINT NOT
NULL,<br>      -- FK to </samp><i><span style="text-decoration: none"><span style="background: transparent">sens.sens</span></span></i><samp class="western">.
 Identifies the sense that pos tag applies to.<br>    ord SMALLINT
NOT NULL,<br>      -- Maintains order of keywords.<br>    kw SMALLINT
 NOT NULL,<br>     -- FK to </samp><i><span style="text-decoration: none"><span style="background: transparent">kwpos.id</span></span></i><samp class="western">.
 Identifies the pos keyword.<br>    PRIMARY KEY
(entr,sens,kw));<br><br>CREATE TABLE rinf (<br>      -- Provides
lists of reading info tags for reading items.  This<br>      --
information corresponds to the JMdict XML &lt;re_inf&gt; element.<br>
   entr INT NOT NULL,<br>      -- FK to </samp><i><span style="text-decoration: none"><span style="background: transparent">entr.id</span></span></i><samp class="western">.
 Identifies entry that the rinf tag applies to.<br>    rdng SMALLINT
NOT NULL,<br>      -- FK to </samp><i><span style="text-decoration: none"><span style="background: transparent">rdng.rdng</span></span></i><samp class="western">.
 Identifies the reading item that rinf tag<br>      -- applies to.<br>
   ord SMALLINT NOT NULL,<br>      -- Maintains order of keywords.<br>
   kw SMALLINT NOT NULL,<br>      -- FK to </samp><i><span style="text-decoration: none"><span style="background: transparent">kwrinf.id</span></span></i><samp class="western">.
 Identifies the reading info keyword.<br>    PRIMARY KEY
(entr,rdng,kw));<br><br><br><br>CREATE TABLE restr (<br>      --
Lists invalid pairs of reading and kanji elements.<br>      -- Note
that this is the inverse of the representation in JMdict<br>      --
XML file where &lt;restr&gt; elements list the _valid_ pairs.<br>   
entr INT NOT NULL,<br>      -- FK to </samp><i><span style="text-decoration: none"><span style="background: transparent">entr.id</span></span></i><samp class="western">.
 Identifies entry that the restriction applies to.<br>    rdng
SMALLINT NOT NULL,<br>      -- FK to </samp><i><span style="text-decoration: none"><span style="background: transparent">rdng.rdng</span></span></i><samp class="western">.
 Identifies the reading within the entry that <br>      -- the
restriction applies to.<br>    kanj SMALLINT NOT NULL,<br>      -- FK
to </samp><i><span style="text-decoration: none"><span style="background: transparent">kanj.kanj</span></span></i><samp class="western">.
 Identifies the kanji within the entry that the <br>      --
restriction applies to.<br>    PRIMARY KEY (entr,rdng,kanj));<br><br>CREATE
TABLE stagr (<br>      -- Lists invalid pairs of sense and reading
elements.<br>      -- Note that this is the inverse of the
representation in JMdict<br>      -- XML file where &lt;stagr&gt;
elements list the _valid_ pairs.<br>    entr INT NOT NULL,<br>     
-- FK to </samp><i><span style="text-decoration: none"><span style="background: transparent">entr.id</span></span></i><samp class="western">.
 Identifies entry that the restriction applies to.<br>    sens
SMALLINT NOT NULL,<br>      -- FK to </samp><i><span style="text-decoration: none"><span style="background: transparent">sens.sens</span></span></i><samp class="western">.
 Identifies the sense within the entry that <br>      -- the
restriction applies to.<br>   rdng SMALLINT NOT NULL,<br>      -- FK
to </samp><i><span style="text-decoration: none"><span style="background: transparent">rdng.rdng</span></span></i><samp class="western">.
 Identifies the reading within the entry that  <br>      -- the
restriction applies to.<br>    PRIMARY KEY (entr,sens,rdng));<br><br>CREATE
TABLE stagk (<br>      -- Lists invalid pairs of sense and kanji
elements.<br>      -- Note that this is the inverse of the
representation in JMdict <br>      -- XML file where &lt;stagk&gt;
elements list the _valid_ pairs.<br>    entr INT NOT NULL,<br>     
-- FK to </samp><i><span style="text-decoration: none"><span style="background: transparent">entr.id</span></span></i><samp class="western">.
 Identifies entry that the restriction applies to.<br>    sens
SMALLINT NOT NULL,<br>      -- FK to </samp><i><span style="text-decoration: none"><span style="background: transparent">sens.sens</span></span></i><samp class="western">.
 Identifies the sense within the entry that  <br>      -- the
restriction applies to.<br>    kanj SMALLINT NOT NULL,<br>      -- FK
to </samp><i><span style="text-decoration: none"><span style="background: transparent">kanj.kanj</span></span></i><samp class="western">.
 Identifies the kanji within the entry that  <br>      -- the
restriction applies to.<br>    PRIMARY KEY (entr,sens,kanj));<br><br><br><br>--
All keyword tables names' start with &quot;kw&quot; and have the<br>--
same structure.  The primary key is a small integer <br>-- and that
is what is used in other table to refer to a<br>-- keyword.  he other
two columns, 'kw' and 'descr' provide<br>-- a short text
abbreviation, and a longer textual description<br>-- for use in
displays to users.<br><br>CREATE TABLE kwdial (<br>    id SMALLINT
PRIMARY KEY,<br>    kw VARCHAR(20) NOT NULL UNIQUE,<br>    descr
VARCHAR(255));<br><br>CREATE TABLE kwfreq (<br>    id SMALLINT
PRIMARY KEY,<br>    kw VARCHAR(20) NOT NULL UNIQUE,<br>    descr
VARCHAR(255));<br><br>CREATE TABLE kwfld (<br>    id SMALLINT PRIMARY
KEY,<br>    kw VARCHAR(20) NOT NULL UNIQUE,<br>    descr
VARCHAR(255));<br><br>CREATE TABLE kwginf (<br>    id SMALLINT
PRIMARY KEY,<br>    kw VARCHAR(20) NOT NULL UNIQUE,<br>    descr
VARCHAR(255));<br><br>CREATE TABLE kwkinf (<br>    id SMALLINT
PRIMARY KEY,<br>    kw VARCHAR(20) NOT NULL,<br>      -- 'kw' not
declared UNIQUE because there are some<br>      -- rows where kw
differs only in case, and this (at<br>      -- in some of the locales
used during testing) violated<br>      -- the unique constraint.<br> 
  descr VARCHAR(255));<br><br>CREATE TABLE kwlang (<br>    id
SMALLINT PRIMARY KEY,<br>    kw VARCHAR(20) NOT NULL UNIQUE,<br>   
descr VARCHAR(255));<br><br>CREATE TABLE kwmisc (<br>    id SMALLINT
PRIMARY KEY,<br>    kw VARCHAR(20) NOT NULL,<br>      -- 'kw' not
declared UNIQUE because there are some<br>      -- rows where kw
differs only in case, and this (at<br>      -- in some of the locales
used during testing) violated<br>      -- the unique constraint.<br> 
  descr VARCHAR(255));<br><br>CREATE TABLE kwpos (<br>    id SMALLINT
PRIMARY KEY,<br>    kw VARCHAR(20) NOT NULL UNIQUE,<br>    descr
VARCHAR(255));<br><br>CREATE TABLE kwrinf (<br>    id SMALLINT
PRIMARY KEY,<br>    kw VARCHAR(20) NOT NULL UNIQUE,<br>    descr
VARCHAR(255));<br><br>CREATE TABLE kwsrc (                  -- Entry
corpora<br>    id SMALLINT PRIMARY KEY,<br>    kw VARCHAR(20) NOT
NULL UNIQUE,<br>    descr VARCHAR(255),<br>    dt DATE,<br>      --
Date associated with this corpus.<br>    notes VARCHAR(255),</samp></p>
<p><samp class="western">    </samp><samp class="western">-- The
following four attributes are used read by a trigger on<br>    -- on
the kwsrc table and used to automatically create a Postgresql<br>   
-- sequence when a new row (corpus) is inserted in kwsrc.  That<br>  
 -- sequence will be used to create corpus-specific entr.seq numbers<br>
   -- when entries of this corpus are inserted in table entr. <br>   
-- The values are only used when a row in inserted in kwsrc;<br>   
-- changing them later will have no effect on the (already created)<br>
   -- sequence. <br>    seq VARCHAR(20) NOT NULL,<br>      -- Name
(sans leading “seq_”) of the Postgresql sequence.<br>    sinc
SMALINT,<br>      -- Increment value of the sequence.<br>    smin
BIGINT,<br>      -- Starting value of the sequence.<br>    smax
BIGINT,<br>      -- Maximum value of the sequence.<br>    srct
SMALLINT NOT NULL);<br>      -- FK to </samp><i><span style="text-decoration: none"><span style="background: transparent">kwsrct.id</span></span></i><samp class="western">.
 Identifies this corpus being of the<br>      -- given source type
where all entries of the same source<br>      -- share certain common
requirements for display and editing.<br><br>CREATE TABLE kwsrct (<br>
   id SMALLINT PRIMARY KEY,<br>    kw VARCHAR(20) NOT NULL UNIQUE,<br>
   descr VARCHAR(255));<br><br>CREATE TABLE kwstat (<br>    id
SMALLINT PRIMARY KEY,<br>    kw VARCHAR(20) NOT NULL UNIQUE,<br>   
descr VARCHAR(255));<br><br>CREATE TABLE kwxref (<br>    id SMALLINT
PRIMARY KEY,<br>    kw VARCHAR(20) NOT NULL UNIQUE,<br>    descr
VARCHAR(255));<br></samp><br/>
<br/>

</p>
<div id="sdfootnote1">
	<p class="sdfootnote"><a class="sdfootnotesym" name="sdfootnote1sym" href="#sdfootnote1anc">1</a>The
	name “gloss” for this table is a misnomer but it is too much
	work to change at this point.  In addition to glosses it contains
	several types of non-gloss translational entities such as literal
	translations.  The <i><span style="text-decoration: none"><span style="background: transparent">ginf</span></span></i>
	column value indicates the type of translational entity in each row.</p>
</div>
<div id="sdfootnote2">
	<p class="sdfootnote"><a class="sdfootnotesym" name="sdfootnote2sym" href="#sdfootnote2anc">2</a>A
	Postgtresql sequence is an object that supplies sequential numbers
	when one is requested.  It is not related to (other than being used
	to generate them) the “sequence” numbers used in JMdictDB
	database entries. 
	</p>
</div>
<div id="sdfootnote3">
	<p class="sdfootnote"><a class="sdfootnotesym" name="sdfootnote3sym" href="#sdfootnote3anc">3</a>Prior
	to April 2008, comments were parsed and those that matched patterns
	for “merged entry” comments were turned into actual deleted
	entries in the database.  However, recent “merged entry”
	comments identify the mergee by kanji rather than sequence number
	and will require a post-load pass to resolve, similar to the way
	xrefs are processed.  The program for this has not been written yet
	(as of May 2008) and currently, all comments are effectively
	ignored. <br> 
	</p>
</div>
<div id="sdendnote1">
	<p class="sdendnote" style="margin-left: 0in; text-indent: 0in"><a class="sdendnotesym" name="sdendnote1sym" href="#sdendnote1anc">[1]</a><a class="western" href="http://www.jb.something/">
	http://www.csse.monash.edu.au/~jwb/edict_doc.html</a></p>
</div>
<div id="sdendnote2">
	<p class="sdendnote"><a class="sdendnotesym" name="sdendnote2sym" href="#sdendnote2anc">[2]</a><a class="western" href="http://www.edrdg.org/~smg/">http://www.edrdg.org/~smg/</a></p>
</div>
<div id="sdendnote3">
	<p class="sdendnote"><a class="sdendnotesym" name="sdendnote3sym" href="#sdendnote3anc">[3]</a>The
	JMdict file is available in two forms: an English-only gloss version
	(<a class="western" href="ftp://ftp.cc.monash.edu.au/pub/nihongo/JMdict_e.gz">ftp://ftp.cc.monash.edu.au/pub/nihongo/JMdict_e.gz</a>),
	and a multi-lingual gloss version
	(<a class="western" href="ftp://ftp.cc.monash.edu.au/pub/nihongo/JMdict.gz">ftp://ftp.cc.monash.edu.au/pub/nihongo/JMdict.gz</a>
	) that is a superset of the English-only version.  The JMdict
	database schema and tools support both versions.  However, the
	non-English glosses in the multi-lingual version were merged in from
	other non-JMdict project files and the integration leaves something
	to be desired so most of the JMdictDB development work uses the
	English-only version.</p>
</div>
<div id="sdendnote4">
	<p class="sdendnote"><a class="sdendnotesym" name="sdendnote4sym" href="#sdendnote4anc">[4]</a><a class="western" href="http://www.edrdg.org/~smg/">http://www.edrdg.org/~smg/</a>.
	 The JMdictDB source code licensed under the GPL and is available
	for download at this URL.</p>
</div>
<div id="sdendnote5">
	<p class="sdendnote"><a class="sdendnotesym" name="sdendnote5sym" href="#sdendnote5anc">[5]</a><a class="western" href="http://www.edrdg.org/~smg/">http://www.postgresql.org/</a></p>
</div>
<div id="sdendnote6">
	<p class="sdendnote"><a class="sdendnotesym" name="sdendnote6sym" href="#sdendnote6anc">[6]</a>The
	schema.png file is distributed with the JMdictDB source code, or at
	<a class="western" href="http://www.edrdg.org/~smg/">http://www.edrdg.org/~smg/jmdict/schema.png</a></p>
</div>
<div title="footer">
	<table width="100%" cellpadding="4" cellspacing="0">
		<col width="127*">
		<col width="44*">
		<col width="85*">
		<tr valign="top">
			<td width="50%" style="border: none; padding: 0in">
				<p><font size="1" style="font-size: 8pt">Stuart McGraw,
				2008-11-10</font></p>
			</td>
			<td width="17%" style="border: none; padding: 0in">
				<p><br/>

				</p>
			</td>
			<td width="33%" style="border: none; padding: 0in">
				<p align="right"><font size="1" style="font-size: 8pt">Page <sdfield type=PAGE subtype=RANDOM format=PAGE>0</sdfield>
				of <sdfield type=DOCSTAT subtype=PAGE format=PAGE>24</sdfield></font></p>
			</td>
		</tr>
	</table>
	<p style="margin-bottom: 0.2in"><br/>
<br/>

	</p>
</div>
</body>
</html>