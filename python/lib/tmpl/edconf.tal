<html xmlns:tal="http://www.owlfish.com/simpletal/4.1/">
<!--? Copyright (c) 2008-2010 Stuart McGraw -->
<!--? $Revision$ $Date$ -->

<!--? ***NOTE***
      Much of this form is very similar to entr.tal and edits made
      to this form likely also need to be made to entr.tal. -->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link rel="stylesheet" type="text/css" href="../jmdict.css"/>
  <script type="text/javascript">
    function toggle_visibility(cls) {
      var elist = document.getElementsByClassName(cls);
        //FIXME: We use the '!=' operator in the 'for' statement
        // because something (the simpleTAL templating system?)
        // escapes '<' and I haven't been able to figure out yet
        // how to prevent that.
      for (var i=0; i!=elist.length; i++) {
        var s = elist[i].style;
        s.display = s.display==='none' ? '' : 'none'; } }
    </script>
  <title>JMdict</title>
</head>
<body>
  <div metal:use-macro="macros/macros/login">
    <h3 metal:fill-slot="title">Confirm Submission</h3>
    </div>

    Please check the entry below carefully.  If it is what you wish
    to submit, click the Submit button.  Otherwise, use your brower's
    <b>Back</b> button to return to the Edit page and make corrections.
    If you have having a problem entering the information you want,
    please send email to
    <a tal:attributes="href string:mailto:${cfg/web/CONTACT_EMAIL}" tal:content="cfg/web/CONTACT_EMAIL">email</a>.
    <p class="caution">Your entry has not yet been submitted.</p>
  <span tal:repeat="e entries">
    <div class="entry">
      <span class="warnings" tal:condition="chklist">
        <p class="warnings" tal:condition="chklist/dups">
          <span class="caution">Caution:</span>
          The following existing entries contain kanji or readings
          that exist in your proposed entry.  Before submitting your
          entry, please make sure that it is not a duplicate of, or
          should not be an amendment to, one of these entries.
          <ol>
            <li tal:repeat="c chklist/dups">
              <a tal:attributes="href string:entr.py?svc=${svc}&amp;sid=${sid}&amp;q=${c/seq}.${c/src}" tal:content="c/seq">seq</a>
              <span tal:condition="c/kanj" tal:content="c/kanj" tal:omit-tag="">kanji</span>
              <span tal:condition="c/kanj">【</span>
              <span tal:content="c/rdng" tal:omit-tag="">reading</span>
              <span tal:condition="c/kanj">】</span>
              <span tal:content="c/gloss" tal:omit-tag="">gloss</span>
              </li>
            </ol>
          </p>
        <p class="warnings" tal:condition="chklist/xrslv">
          <span class="caution">Caution:</span>
          Your entry contains some xrefs that were not resolvable to other
          entries in this corpus, either because no entries matched the seq
          number, kanji, and reading you gave, or because multiple entries
          did.  In the latter case you may be able to give the target more
          specifically by giving a seq number or reading with the kanji.
          Use your browsers 'back" button to return to the previous page
          to make corrections.  Alternatively, you may submit this entry
          as is for later correction, but please note that entries with
          unresolved xrefs can't be approved.
          <ol>
            <li tal:repeat="x chklist/xrslv">
              <span tal:replace="x">message</span>
              </li>
            </ol>
          </p>
        <p class="warnings" tal:condition="chklist/xrers">
          <span class="caution">Caution:</span>
          The xrefs below are on other entries and point to the entry
          you have edited.  If you submit this entry they will be deleted
          because they refer to a sense, reading or kanji that no longer
          exists on this entry.
          If you want to fix any of these xrefs, you will need to edit the
          other entry and add them back with the appropriate corrections,
          <b>after this one is submitted</b>.
          (Numbers in square brackets are sense numbers.)
          <ol>
            <li tal:repeat="x chklist/xrers">
              <a tal:attributes="href string:entr.py?svc=${svc}&amp;sid=${sid}&amp;e=${x/0}" tal:content="x/1">seq#</a>[<span tal:replace="x/2"/>] =&gt;
              <span tal:replace="x/3"/>[<span tal:replace="x/4"/>]
              </li>
            </ol>
          </p>
        <p class="warnings" tal:condition="chklist/invkebs">
          <span class="caution">Caution:</span>
          The following kanji are not valid:
          <span tal:replace="chklist/invkebs"/>
          </p>
        <p class="warnings" tal:condition="chklist/invrebs">
          <span class="caution">Caution:</span>
          The following readings are not valid:
          <span tal:replace="chklist/invrebs"/>
          </p>
        <p class="warnings" tal:condition="chklist/norebs">
          <span class="caution">Caution:</span>
          No readings were given.  At least one reading is required.<p/>
          </p>
        <p class="warnings" tal:condition="chklist/nopos">
          <span class="caution">Caution:</span>
          One or more senses you gave do not have any PoS (Part-of-Speech,
          for example [n], [v5k], etc.) tags.  Note that PoS tags must be
          specified on each sense explicitly -- they do not
          carry over from the preceeding sense.
          </p>
        <p class="warnings" tal:condition="chklist/jpgloss">
          <span class="caution">Caution:</span>
          The following (sense.gloss) numbers identify glosses that contain
          one or more JIS "fullwidth" character(s).  Please replace them with
          ordinary (ASCII) characters.  In particular, please note that a JIS
          semicolon (；) will not be interpreted as a gloss separator.
          <p/>&nbsp;&nbsp;Sense.gloss: <span tal:repeat="x chklist/jpgloss">
            <span tal:replace="x">(sense.gloss)</span>
            </span>
          </p>
        <hr/>
        </span>

      <span tal:replace="structure python:TALabbr('SRC',e.src)">src</span>
      <a tal:attributes="href string:entr.py?svc=${svc}&amp;sid=${sid}&amp;q=${e/seq}.${e/src}" tal:content="e/seq">seq#</a>
      <span class="status">
        <span tal:condition="e/unap" class="pend">
          <span tal:content="python:TALdescr('STAT',e.stat)">status</span> pending
          </span>
        <span tal:condition="not:e/unap" tal:content="python:TALdescr('STAT',e.stat)">status</span>
        <span tal:condition="e/dfrm" tal:omit-tag="">
          (parent: <a tal:attributes="href string:entr.py?svc=${svc}&amp;sid=${sid}&amp;e=${e/dfrm}" tal:content="e/dfrm"/>)
          </span>
        </span>
      <span class="pkid" tal:condition="python:e.id&gt;0">{id:<span tal:replace="e/id" tal:omit-tag=""/>}</span>

      <span tal:condition="e/srcnote">
        <br/>Src Notes: <span tal:replace="e/srcnote" tal:omit-tag="">srcnote</span>
        </span>
      <span tal:condition="e/notes">
        <br/>Entry Notes: <span tal:replace="e/notes" tal:omit-tag="">srcnote</span>
        </span>

      <br/>
      <span tal:condition="e/_kanj" tal:repeat="k e/_kanj" tal:omit-tag="">
        <span tal:condition="not:repeat/k/start" tal:omit-tag="">； </span>
        <span class="kanj" tal:content="k/txt">kanji text</span>
        <span class="kattrs" tal:condition="python:TALattror(k,'_inf','_freq')">
          [<span class="kinf" tal:condition="k/_inf" tal:content="structure python:TALabbrs('KINF',k,'_inf')">kinf</span>
           <span tal:condition="python:TALattrand(k,'_inf','_freq')" tal:replace="string:/">/</span>
           <span class="kfreq" tal:condition="k/_freq" tal:content="structure python:TALfreqs(k)">kfreq</span>]
          </span>
        </span>

      <br tal:condition="e/HAS_RESTR"/>
      <span tal:condition="python:TALattrand(e,'_kanj','_rdng')" tal:omit-tag="">【</span>
      <span tal:repeat="r e/_rdng">
        <span tal:condition="not:repeat/r/start" tal:omit-tag="">； </span>
        <span class="rdng" tal:content="r/txt">reading text</span>
        <span class="restr" tal:condition="r/_RESTR">(
          <span tal:repeat="z r/_RESTR" tal:omit-tag="">
            <span tal:condition="not:repeat/z/start" tal:omit-tag="">,</span>
            <span tal:replace="z"/>
            </span>)
          </span>
        <span class="rattrs" tal:condition="python:TALattror(r,'_inf','_freq')">
          [<span class="rinf" tal:condition="r/_inf" tal:content="structure python:TALabbrs('RINF',r,'_inf')">rinf</span>
          <span tal:condition="python:TALattrand(r,'_inf','_freq')" tal:replace="string:/">/</span>
          <span class="rfreq" tal:condition="r/_freq" tal:content="structure python:TALfreqs(r)">rfreq</span>]
          </span>
        </span>
      <span tal:condition="python:TALattrand(e,'_kanj','_rdng')" tal:omit-tag="">】</span>

      <table class="senses" border="0" tal:condition="e/_sens">
        <tr class="sense" tal:repeat="s e/_sens">
          <td valign="top" tal:content="string:${s/sens}.">n.</td>
          <td colspan="2">
            <span class="stag" tal:condition="s/_STAG">
              (<span tal:condition="s/_STAG" tal:repeat="z s/_STAG" tal:omit-tag="">
                <span tal:condition="not:repeat/z/start" tal:omit-tag="">,</span>
                <span tal:replace="z" tal:omit-tag="">stag-restr</span>
                </span> only)
              </span>
            <span class="pos" tal:condition="s/_pos">
              [<span tal:replace="structure python:TALabbrs('POS',s,'_pos')">pos</span>]
              </span>
            <span class="misc" tal:condition="s/_misc">
              [<span tal:replace="structure python:TALabbrs('MISC',s,'_misc')">misc</span>]
              </span>
            <span class="fld" tal:condition="s/_fld">
              {<span tal:replace="python:TALdescrs('FLD',s,'_fld')">fields</span>}
              </span>

            <span class="dial" tal:condition="s/_dial">,
              Dialect: <span tal:replace="structure python:TALabbrs('DIAL',s,'_dial')">dial</span>
              </span>
            <span class="lsrc" tal:condition="s/_lsrc">,
              From
              <span tal:repeat="z s/_lsrc" tal:omit-tag="">
                <span tal:replace="structure python:TALabbr('LANG',z.lang)">(xx)</span
                ><span tal:condition="python:TALattror(z,'part','wasei')" tal:omit-tag=""
                  >(<span tal:condition="z/part" tal:replace="string: p">p</span
                  ><span tal:condition="python:TALattrand(z,'part','wasei')" tal:replace="string: ,">,</span
                  ><span tal:condition="z/wasei" tal:replace="string: w">w</span
                  >)</span
                >:<span tal:condition="z/txt" tal:omit-tag="">
                  "<span tal:replace="z/txt">lsource text</span
                  >"</span
                ><span tal:condition="not:repeat/z/end" tal:omit-tag="">,</span>
                </span>
              </span>

            <br/>
            <span class="note" tal:condition="s/notes">
              《<span tal:replace="s/notes">sense-notes</span>》<br/>
              </span>

            <span tal:condition="s/_gloss" tal:omit-tag="">
              <span tal:repeat="g s/_gloss" tal:omit-tag="">
              <span class="gloss" tal:replace="string:▶">num.</span>
                <span tal:condition="python:1!=g.lang" tal:omit-tag="">
                  <span class="glang" tal:replace="structure python:TALabbr('LANG',g.lang)">lang</span>:
                  </span>
                <span tal:condition="python:1!=g.ginf" tal:omit-tag="">
                  [<span class="ginf" tal:replace="structure python:TALabbr('GINF',g.ginf)">lang</span>.]
                  </span>
                <span tal:replace="g/txt">gloss</span><br/>
                </span>
              </span>

            <table class="xrefs" tal:condition="python:TALattror(s,'XREF','XRER','_xrslv')">
              <!-- s.XREF and s.XRER are identical to s._xref and s._xrer except
                   some refs (e.g. to unapproved entries) have been removed. They
                   can be added to an entry by jmcgi.add_filtered_xrefs(). -->
              <tr tal:condition="s/XREF">
                <td colspan="2">Cross references:</td>
                </tr>
              <tr tal:condition="s/XREF" tal:repeat="x s/XREF">
                  <td>&nbsp;</td>
                  <td tal:define="knum python:TALdecode(x.direc,1,x.kanj,0,x.kanj,-1,1); 
                                  rnum python:TALdecode(x.direc,1,x.rdng,0,x.rdng,-1,1)">
                    <span tal:replace="python:TALdecode(x.direc,1,'\u21D2',0,'\u21D4',-1,'\u21D0')"></span>
                    <span tal:replace="structure python:TALabbr('XREF',x.typ)">xref-type</span>:
                    <a tal:attributes="href string:entr.py?svc=${svc}&amp;sid=${sid}&amp;e=${x/xentr}" tal:content="x/TARG/seq">seq-num</a>
                    <span tal:condition="x/TARG/_kanj" tal:replace="python:TALkrtxt(x.TARG,'_kanj',knum)">xref-kanj</span>
                    <span tal:condition="python:TALattrand(x,'kanj','rdng')" tal:omit-tag="">【</span>
                    <span tal:condition="x/TARG/_rdng" tal:replace="python:TALkrtxt(x.TARG,'_rdng',rnum)">xref-rdng</span>
                    <span tal:condition="python:TALattrand(x,'kanj','rdng')" tal:omit-tag="">】</span>
                    <span tal:replace="x/xsens">s#</span
                    >.<span tal:replace="python:TALtxts(x.TARG._sens[x.xsens-1],'_gloss')"></span>
                    <span tal:condition="x/notes" replace="x/notes">xref-note</span>
                    </td>
                </tr>
              <tr tal:condition="s/_xrslv">
                <td colspan="2">Unresolved cross references:</td>
                </tr>
              <tr tal:condition="s/_xrslv" tal:repeat="x s/_xrslv">
                <td>&nbsp;</td>
                <td>
                  <span tal:replace="structure python:TALabbr('XREF',x.typ)">xrslv-type</span>:
                  <span tal:condition="x/ktxt" tal:replace="x/ktxt">xrslv-kanj</span>
                  <span tal:condition="python:TALattrand(x,'ktxt','rtxt')" tal:omit-tag="">・</span>
                  <span tal:condition="x/rtxt" tal:replace="x/rtxt">xrslv-rdng</span>
                  </td>
                </tr>
              <tr tal:condition="s/XRER">
                <td colspan="2">References to this sense:</td>
                </tr>
              <tr tal:condition="s/XRER" tal:repeat="x s/XRER">
                <td>&nbsp;</td>
                <td>
                  <span tal:replace="structure python:TALabbr('XREF',x.typ)">xref-type</span>:
                  <a tal:attributes="href string:entr.py?svc=${svc}&amp;sid=${sid}&amp;e=${x/entr}" tal:content="x/TARG/seq">seq-num</a>
                  <span tal:condition="x/TARG/_kanj" tal:replace="x/TARG/_kanj/0/txt">xref-kanj</span>
                  <span tal:condition="python:TALattrand(x.TARG,'_kanj','_rdng')" tal:omit-tag="">【</span>
                  <span tal:condition="x/TARG/_rdng" tal:replace="x/TARG/_rdng/0/txt">xref-rdng</span>
                  <span tal:condition="python:TALattrand(x.TARG,'_kanj','_rdng')" tal:omit-tag="">】</span>
                  <span tal:replace="x/sens">s#</span
                  >.<span tal:replace="python:TALtxts(x.TARG._sens[x.sens-1],'_gloss')"></span>
                  <span tal:condition="x/notes" replace="x/notes">xref-note</span>
                  </td>
                </tr>
              </table>
            </td>
          </tr>
        </table>

      <span call="kdinfo" tal:condition="e/chr" tal:omit-tag=""><br/>
        <table valign="top">
          <tr>
            <th>Kanji details</th><th>&nbsp;&nbsp;&nbsp;&nbsp;</th>
            <th>References</th><th>&nbsp;&nbsp;&nbsp;&nbsp;</th>
            <th tal:condition="e/chr/enc" omit-tag="">Encodings</th>
            </tr>
          <tr>
            <td valign="top">
              <table class="kddetails" border="1">
                <tr><td>Strokes:</td><td tal:content="e/chr/strokes"></td></tr>
                <tr><td>Radical:</td><td tal:content="python:e.chr.bushu or u'&nbsp;'"></td></tr>
                <tr><td>Radical name:</td><td tal:content="python:e.chr.radname or u'&nbsp;'"></td></tr>
                <tr><td>Grade:</td><td tal:content="python:e.chr.grade or u'&nbsp;'"></td></tr>
                <tr><td>Freq:</td><td tal:content="python:e.chr.freq or u'&nbsp;'"></td></tr>
                <tr><td>JLPT:</td><td tal:content="python:e.chr.jlpt or u'&nbsp;'"></td></tr>
                </table>
              </td>
            <td></td>
            <td valign="top">
              <table class="kdrefs" border="1">
                <tr tal:repeat="rf e/chr/_cinf">
                  <td tal:content="structure python:TALabbr('CINF',rf.kw)" tal:attributes="title python:TALdescr('CINF',rf.kw)">kwname</td>
                  <td tal:condition="python:TALabbrtxt('CINF',rf.kw)!='gahoh'" tal:content="rf/value">value</td>
                  <td tal:condition="python:TALabbrtxt('CINF',rf.kw)=='gahoh'">
                    <a tal:condition="cfg/web/GAHOH_URL" tal:content="rf/value"
                       tal:attributes="href string:${cfg/web/GAHOH_URL}${rf/value}">gahoh-url</a>
                    <span tal:condition="not:cfg/web/GAHOH_URL" tal:content="rf/value">gahoh-value</span></td>
                  </tr>
                </table>
              </td>
            <td></td>
            <td valign="top" tal:condition="e/chr/enc" omit-tag="">
              <table class="kdenc" border="1">
                <tr><td>Unicode:</td><td><a tal:content="e/chr/enc/uni" tal:attributes="href e/chr/enc/uurl"></a></td></tr>
                <tr><td>UTF-8:</td><td tal:content="e/chr/enc/utf8"></td></tr>
                <tr><td>JIS:</td><td tal:content="e/chr/enc/jis"></td></tr>
                <tr><td>ISO2022JP:</td><td tal:content="e/chr/enc/iso2022jp"></td></tr>
                <tr><td>SJIS:</td><td tal:content="e/chr/enc/sjis"></td></tr>
                <tr><td>EUCJP:</td><td tal:content="e/chr/enc/eucjp"></td></tr>
                </table>
              </td>
            </tr>
          </table>
        </span>

      <span tal:condition="e/_grp" tal:omit-tag=""><br/>Belongs to groups:
        <span tal:repeat="g e/_grp" tal:omit-tag="">
          <span class="grp">
            <span tal:replace="structure python:TALabbr('GRP',g.kw)" tal:omit-tag="">grpname</span
            >(<span tal:replace="g/ord">ord</span
            >)<span tal:condition="not:repeat/g/end" tal:omit-tag="">,</span>
            </span>
          </span>
        </span>

      <span tal:condition="e/HAS_AUDIO" tal:omit-tag=""><br/>Audio:
        <table class="audio" border=1>
          <tr tal:repeat="a e/_snd">
            <td>&nbsp;</td>
            <td tal:content="a/snd">snd-id</td>
            <span tal:condition="a/CLIP" tal:omit-tag="">
              <td tal:content="a/CLIP/sdir">snd-dir</td>
              <td tal:content="a/CLIP/sfile">snd-file</td>
              <td tal:content="a/CLIP/strt">snd-strt</td>
              <td tal:content="a/CLIP/leng">snd-leng</td>
              </span>
            </tr>
          <span tal:repeat="r e/_rdng" tal:omit-tag="">
            <tr tal:repeat="a r/_snd">
              <td tal:content="r/txt">reading-text</td>
              <td tal:repeat="a r/_snd">snd-id</td>
              <span tal:condition="a/CLIP" tal:omit-tag="">
                <td tal:content="a/CLIP/sdir">snd-dir</td>
                <td tal:content="a/CLIP/sfile">snd-file</td>
                <td tal:content="a/CLIP/strt">snd-strt</td>
                <td tal:content="a/CLIP/leng">snd-leng</td>
                </span>
              </tr>
            </span>
          </table>
        </span>

      <br/>
      <form action="edsubmit.py" tal:attributes="method method">
        <input type="hidden" name="svc" tal:condition="svc" tal:attributes="value svc"/>
        <input type="hidden" name="sid" tal:condition="sid" tal:attributes="value sid"/>
        <input type="hidden" name="entr" tal:attributes="value serialized"/>
        <input type="hidden" name="dbg" tal:attributes="value dbg"/>
        <input type="Submit" value="Submit"/>
        <span class="caution" tal:condition="disp">
          &nbsp;&nbsp;
          <span tal:condition="python:disp=='a'" tal:omit-tag="">Approve</span>
          <span tal:condition="python:disp=='r'" tal:omit-tag="">Reject</span>
          <input type="hidden" name="disp" tal:attributes="value disp"/>
          </span>
        </form>

      <div class="hist" tal:condition="e/_hist">
        <br/>History: 
        <table>
          <tbody class="histtab">
            <span tal:repeat="h e/_hist" tal:omit-tag="">

              <span tal:condition="h/email" tal:omit-tag="">
                <span tal:condition="session/userid" tal:omit-tag="">
                  <span tal:define="global email string:&lt;${h/email}&gt;" tal:omit-tag=""/>
                  </span>
                <span tal:condition="not:session/userid" tal:omit-tag="">
                  <span tal:define="global email string:&lt;...address hidden...&gt;" tal:omit-tag=""/>
                  </span>
                </span>
              <span tal:condition="not:h/email" tal:omit-tag="">
                <span tal:define="global email string:" tal:omit-tag=""/>
                </span>

  <span tal:replace="nothing"> Comment:
  See comment in entr.tal re changing the number histories always shown.</span>
              <span tal:condition="python: repeat['h'].number()&gt;5" tal:omit-tag="">
                <span tal:define="global cls string:hist_${e/id}" tal:omit-tag=""/>
                <span tal:define="global dsp string:display:none" tal:omit-tag=""/>
                </span>
              <tr tal:condition="python: repeat['h'].index()==5"><td colspan="3"> 
                <span class="fakelink" tal:attributes="onclick string:toggle_visibility('hist_${e/id}')">
                  <font size="-1">(show/hide <span tal:replace="python:len(e._hist)-5"></span> older log entries)</font>
                  </span>
                </td></tr>

              <tr tal:attributes="class cls;style dsp">
                <td tal:content="string:${h/hist}.">#.</td>
                <td class="hhdr" colspan="2">
                  <span tal:content="string: ${python:TALabbrtxt('STAT',h.stat)}${python:'*' if h.unap else ''}"/>
                  <span tal:content="h/dt">timestamp</span>&nbsp;
                  <span class="submitter_name" tal:content="h/name">name</span>
                  <span tal:content="email">email</span>
                  </td>
                </tr>
              <tr tal:condition="h/refs"  tal:attributes="class cls;style dsp">
                <td>&nbsp;</td>
                <td valign="top">Refs:</td>
                <td><pre class="preformat" tal:content="h/refs">refs</pre></td>
                </tr>
              <tr tal:condition="h/notes" tal:attributes="class cls;style dsp">
                <td>&nbsp;</td>
                <td valign="top">Comments:</td>
                <td><pre class="preformat" tal:content="h/notes">notes</pre></td>
                </tr>
              <tr tal:condition="h/diff" tal:attributes="class cls;style dsp">
                <td>&nbsp;</td>
                <td valign="top">Diff:</td>
                <td><pre class="preformat" tal:content="h/diff">diff</pre></td>
                </tr>
              </span>
            </tbody>
          </table>
        </div><!-- end class="hist" -->

      </div>
    </span>
    <div metal:use-macro="macros/macros/footer"></div>
  </body>
</html>
